{"version":3,"file":"ZonePage-Bo8qpbtq.js","sources":["../../../miraedojeon/front/src/pages/ExtInt/Internal/ZonePage.jsx"],"sourcesContent":["// src/ZonePage.jsx\r\nimport React, { useRef, useEffect, useState, useMemo } from \"react\";\r\nimport ForceGraph3D from \"react-force-graph-3d\";\r\nimport * as THREE from \"three\";\r\n\r\nconst TYPE_COLORS = {\r\n  core: \"#ffffff\",\r\n  firewall: \"#e55353\",\r\n  router: \"#f6a609\",\r\n  l3switch: \"#f6a609\",\r\n  switchrouter: \"#f6a609\",\r\n  layer3: \"#f6a609\",\r\n  switch: \"#3fb950\",\r\n  hub: \"#26c6da\",\r\n  server: \"#6aa7ff\",\r\n  host: \"#6aa7ff\",\r\n  default: \"#a0b4ff\",\r\n};\r\n\r\nexport default function ZonePage({ zone, onBack, onInspectorChange, setEventLogs }) {\r\n  const fgRef = useRef();\r\n  const graphContainerRef = useRef(null);\r\n  const [zoneGraph, setZoneGraph] = useState({ nodes: [], links: [] });\r\n  const [loading, setLoading] = useState(false);\r\n  const [selected, setSelected] = useState(null);\r\n  const NODE_SCALE_MULT = 1.7; // match network_topology scaling\r\n  // 정확한 캔버스 크기 전달을 위한 컨테이너 측정 상태\r\n  const [containerSize, setContainerSize] = useState({ width: 0, height: 0 });\r\n\r\n  useEffect(() => {\r\n    if (zone === null || zone === undefined) return;\r\n    let mounted = true;\r\n    (async () => {\r\n      try {\r\n        setLoading(true);\r\n        const res = await fetch(`http://localhost:8000/neo4j/nodes?activeView=zone${zone}`);\r\n        const data = await res.json();\r\n\r\n        const nodesMap = new Map();\r\n        const rawLinks = [];\r\n        data.forEach((item) => {\r\n          if (item.src_IP?.id) nodesMap.set(String(item.src_IP.id), item.src_IP);\r\n          if (item.dst_IP?.id) nodesMap.set(String(item.dst_IP.id), item.dst_IP);\r\n          if (item.edge?.sourceIP && item.edge?.targetIP) {\r\n            rawLinks.push({\r\n              source: String(item.edge.sourceIP),\r\n              target: String(item.edge.targetIP),\r\n              ...item.edge,\r\n            });\r\n          }\r\n        });\r\n\r\n        const nodeIds = new Set([...nodesMap.keys()]);\r\n        const filtered = rawLinks.filter((l) => nodeIds.has(l.source) && nodeIds.has(l.target));\r\n\r\n        const seen = new Set();\r\n        const links = [];\r\n        for (const l of filtered) {\r\n          const a = String(l.source);\r\n          const b = String(l.target);\r\n          const key = a < b ? `${a}__${b}__${l.type || \"\"}` : `${b}__${a}__${l.type || \"\"}`;\r\n          if (seen.has(key)) continue;\r\n          seen.add(key);\r\n          links.push(l);\r\n        }\r\n\r\n        const nodes = Array.from(nodesMap.values()).map((n) => {\r\n          const kind = (n.kind || n.type || \"host\").toLowerCase();\r\n          const label = n.label || n.ip || String(n.id);\r\n          const color = n.color || TYPE_COLORS[kind] || TYPE_COLORS.default;\r\n          const status = n.status || \"up\";\r\n          const subnet =\r\n            n.subnet\r\n              ? n.subnet\r\n              : typeof n.ip === \"string\" && n.ip.includes(\".\")\r\n              ? n.ip.split(\".\").slice(0, 3).join(\".\") + \".0/24\"\r\n              : \"unknown/24\";\r\n          const zoneNum = Number.isFinite(n.zone) ? n.zone : null;\r\n          return { ...n, id: String(n.id), kind, label, color, status, subnet, zone: zoneNum };\r\n        });\r\n\r\n        if (mounted) setZoneGraph({ nodes, links });\r\n      } catch (e) {\r\n        console.error(e);\r\n        if (mounted) setZoneGraph({ nodes: [], links: [] });\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    })();\r\n    return () => { mounted = false; };\r\n  }, [zone]);\r\n\r\n  const geoCache = useMemo(\r\n    () => ({\r\n      torus: new THREE.TorusGeometry(7, 1.6, 16, 32),\r\n      cone: new THREE.ConeGeometry(4.2, 9, 10),\r\n      cylinder: new THREE.CylinderGeometry(4.2, 4.2, 8, 18),\r\n      box: new THREE.BoxGeometry(8.2, 2.6, 6.2),\r\n      l3top: new THREE.CylinderGeometry(2.8, 2.8, 2.2, 16),\r\n      sphere: new THREE.SphereGeometry(3.0, 16, 16),\r\n      led: new THREE.SphereGeometry(0.7, 8, 8),\r\n      hit: new THREE.SphereGeometry(7, 8, 8),\r\n      octa: new THREE.OctahedronGeometry(4.2, 0), // ★ hub용 누락 보완\r\n      dashUnit: new THREE.CylinderGeometry(1, 1, 1, 10),\r\n    }),\r\n    []\r\n  );\r\n\r\n  const nodeMatCache = useMemo(\r\n    () => ({\r\n      base: new Map(),\r\n      highlight: new THREE.MeshStandardMaterial({ color: 0xffda79, metalness: 0.25, roughness: 0.72 }),\r\n      dim: new THREE.MeshStandardMaterial({ color: 0x324055, metalness: 0.25, roughness: 0.72 }),\r\n      ledUp: new THREE.MeshBasicMaterial({ color: 0x00ff99 }),\r\n      ledDown: new THREE.MeshBasicMaterial({ color: 0xff3355 }),\r\n      hit: new THREE.MeshBasicMaterial({ opacity: 0.0, transparent: true, depthWrite: false }),\r\n      dashedBase: new THREE.MeshStandardMaterial({ color: 0x87aafc, metalness: 0.15, roughness: 0.6, transparent: true, opacity: 0.98, depthWrite: false, polygonOffset: true, polygonOffsetFactor: -1 }),\r\n      dashedInc: new THREE.MeshStandardMaterial({ color: 0x3a6fe2, metalness: 0.2, roughness: 0.55, transparent: true, opacity: 1.0, depthWrite: false, polygonOffset: true, polygonOffsetFactor: -1 }),\r\n    }),\r\n    []\r\n  );\r\n\r\n  // Dash/curve helpers (render logical links as grouped cylinders)\r\n  const DASH_CONF = {\r\n    count: 16,\r\n    ratio: 0.58,\r\n    baseRadius: 1.35,\r\n    incRadius: 2.8,\r\n  };\r\n\r\n  function getCurve(start, end, curvature = 0.12, rotation = 0) {\r\n    const v = new THREE.Vector3().subVectors(end, start);\r\n    const len = v.length() || 1;\r\n    const mid = new THREE.Vector3().addVectors(start, end).multiplyScalar(0.5);\r\n    const a = Math.abs(v.x) < 0.9 ? new THREE.Vector3(1,0,0) : new THREE.Vector3(0,1,0);\r\n    const perp = new THREE.Vector3().crossVectors(v, a).normalize();\r\n    perp.applyAxisAngle(v.clone().normalize(), rotation);\r\n    const amp = curvature * len * 2.0;\r\n    const ctrl = perp.multiplyScalar(amp).add(mid);\r\n    return new THREE.QuadraticBezierCurve3(start, ctrl, end);\r\n  }\r\n\r\n  function ensureDashMeshes(group, dashCount, geo, matBase, matInc) {\r\n    if (!group.userData.dashes) group.userData.dashes = [];\r\n    const cur = group.userData.dashes;\r\n    while (cur.length < dashCount) { const m = new THREE.Mesh(geo, matBase); m.castShadow = false; m.receiveShadow = false; cur.push(m); group.add(m); }\r\n    while (cur.length > dashCount) { const m = cur.pop(); group.remove(m); m.geometry?.dispose?.(); }\r\n    group.userData.matBase = matBase; group.userData.matInc = matInc;\r\n  }\r\n\r\n  // enhance meshes after creation to minimize z-fighting\r\n  function enhanceDashMesh(mesh) {\r\n    try {\r\n      mesh.renderOrder = 10;\r\n      if (mesh.material) {\r\n        mesh.material.depthWrite = false;\r\n        mesh.material.polygonOffset = true;\r\n        mesh.material.polygonOffsetFactor = -1;\r\n      }\r\n    } catch (e) {}\r\n  }\r\n\r\n  function placeCylinderBetween(mesh, a, b, radius) {\r\n    const dir = new THREE.Vector3().subVectors(b, a);\r\n    const L = dir.length();\r\n    if (L < 1e-6) { mesh.visible = false; return; }\r\n    mesh.visible = true;\r\n    const mid = new THREE.Vector3().addVectors(a, b).multiplyScalar(0.5);\r\n    mesh.position.copy(mid);\r\n    mesh.quaternion.setFromUnitVectors(new THREE.Vector3(0,1,0), dir.clone().normalize());\r\n    mesh.scale.set(radius, L, radius);\r\n  }\r\n\r\n  const hashId = (s) => { s = String(s || ''); let h = 0; for (let i=0;i<s.length;i++) h = (h*131 + s.charCodeAt(i)) >>> 0; return h; };\r\n\r\n  function linkCurvature(l) { return 0.12; }\r\n  function linkCurveRotation(l) { return ((hashId(getId(l.source)) + hashId(getId(l.target))) % 628) / 100; }\r\n\r\n  function linkThreeObject(l) {\r\n    if (String(l.type || '').toLowerCase() !== 'logical') return undefined;\r\n    const group = new THREE.Group(); group.userData = { type: 'logical-dashed', link: l, dashes: [] };\r\n    return group;\r\n  }\r\n\r\n  function updateLogicalDashed(l, group) {\r\n      // Resolve endpoints: l.source/l.target may be ids (strings) or node objects\r\n      const srcObj = (l.source && typeof l.source === 'object') ? l.source : zoneGraph.nodes.find(n => String(n.id) === String(l.source));\r\n      const tgtObj = (l.target && typeof l.target === 'object') ? l.target : zoneGraph.nodes.find(n => String(n.id) === String(l.target));\r\n      if (!srcObj || !tgtObj) { group.visible = false; return; }\r\n      const start = new THREE.Vector3(srcObj.x || 0, srcObj.y || 0, srcObj.z || 0);\r\n      const end = new THREE.Vector3(tgtObj.x || 0, tgtObj.y || 0, tgtObj.z || 0);\r\n\r\n      // Estimate node clearance (approximate visible radius) to trim curve endpoints\r\n      const estimateClearance = (node) => {\r\n        if (!node) return 3.0;\r\n        // Mirror the sizing logic used in nodeThreeObjectHL: base radius ~3 * scale\r\n        const deg = node.__deg || 0;\r\n        const s = node.kind === 'core' ? 1.4 : Math.max(0.9, Math.min(1.8, 0.95 + (deg) * 0.06));\r\n        return 3.0 * s; // base geometry radius ~3 units scaled\r\n      };\r\n      const cStart = estimateClearance(srcObj);\r\n      const cEnd = estimateClearance(tgtObj);\r\n      const totalVec = new THREE.Vector3().subVectors(end, start);\r\n      const totalLen = totalVec.length() || 1;\r\n      const dir = totalVec.clone().normalize();\r\n      // Trimmed endpoints to avoid overlapping node geometry\r\n      const trimmedStart = start.clone().add(dir.clone().multiplyScalar(Math.min(cStart, totalLen*0.4)));\r\n      const trimmedEnd = end.clone().add(dir.clone().multiplyScalar(-Math.min(cEnd, totalLen*0.4)));\r\n  const curve = getCurve(trimmedStart, trimmedEnd, linkCurvature(l), linkCurveRotation(l));\r\n    const dashCount = DASH_CONF.count; const dashRatio = DASH_CONF.ratio;\r\n    ensureDashMeshes(group, dashCount, geoCache.dashUnit, nodeMatCache.dashedBase, nodeMatCache.dashedInc);\r\n    const incident = !!(selected && (getId(l.source) === selected.id || getId(l.target) === selected.id));\r\n    const radius = incident ? DASH_CONF.incRadius : DASH_CONF.baseRadius; const mat = incident ? group.userData.matInc : group.userData.matBase;\r\n      // Small offsets to avoid dashes overlapping node geometry (clamp t0/t1 inward)\r\n      const EPS = 1.0 / (dashCount * 12); // smaller fraction\r\n      const capTrim = Math.min(0.08, Math.max(0.02, (cStart + cEnd) / (totalLen * 4)));\r\n      for (let i = 0; i < dashCount; i++) {\r\n        const baseT0 = i / dashCount;\r\n        const baseT1 = Math.min(1, baseT0 + (dashRatio / dashCount));\r\n        const t0 = Math.max(0 + capTrim, baseT0 + EPS);\r\n        const t1 = Math.min(1 - capTrim, baseT1 - EPS);\r\n        if (t1 <= t0) { const mesh = group.userData.dashes[i]; if (mesh) mesh.visible = false; continue; }\r\n        const a = curve.getPoint(t0); const b = curve.getPoint(t1);\r\n        const mesh = group.userData.dashes[i]; if (!mesh) continue; mesh.material = mat; placeCylinderBetween(mesh, a, b, Math.max(0.2, radius)); enhanceDashMesh(mesh);\r\n      }\r\n      group.visible = true;\r\n  }\r\n\r\n  const getBaseMat = (hex) => {\r\n    let m = nodeMatCache.base.get(hex);\r\n    if (!m) {\r\n      m = new THREE.MeshStandardMaterial({ color: new THREE.Color(hex), metalness: 0.25, roughness: 0.72 });\r\n      nodeMatCache.base.set(hex, m);\r\n    }\r\n    return m;\r\n  };\r\n\r\n  // Build adjacency map for neighbor highlighting\r\n  const adjacency = useMemo(() => {\r\n    const m = new Map();\r\n    zoneGraph.links.forEach((l) => {\r\n      const a = l.source;\r\n      const b = l.target;\r\n      if (!m.has(a)) m.set(a, new Set());\r\n      if (!m.has(b)) m.set(b, new Set());\r\n      m.get(a).add(b);\r\n      m.get(b).add(a);\r\n    });\r\n    return m;\r\n  }, [zoneGraph]);\r\n\r\n  // ID 정규화 헬퍼: 링크 끝점이 \"문자열\" 또는 \"노드 객체\" 모두 대응\r\n  const getId = (end) => (end && typeof end === \"object\" ? (end.id ?? end.__id ?? String(end)) : String(end));\r\n\r\n  // Highlight logic for nodes/links\r\n  const isHLNode = (n) => selected && (n.id === selected.id || adjacency.get(selected.id)?.has(n.id));\r\n  const isIncident = (l) => selected && (getId(l.source) === selected.id || getId(l.target) === selected.id); // ★ 수정\r\n\r\n  // Send inspector data to parent (internaltopology) event log\r\n  useEffect(() => {\r\n    if (!selected || !setEventLogs) {\r\n      return;\r\n    }\r\n    \r\n    // Collect connected node information\r\n    const connectedNodes = adjacency.get(selected.id) || new Set();\r\n    const connectedIps = Array.from(connectedNodes)\r\n      .map(nid => {\r\n        const node = zoneGraph.nodes.find(n => n.id === nid);\r\n        return node?.ip;\r\n      })\r\n      .filter(ip => ip);\r\n    \r\n    // Collect all link details (dbInfo) for clicked node\r\n    const dbInfo = zoneGraph.links\r\n      .filter(link => {\r\n        const sid = typeof link.source === 'object' ? link.source.id : link.source;\r\n        const tid = typeof link.target === 'object' ? link.target.id : link.target;\r\n        return sid === selected.id || tid === selected.id;\r\n      })\r\n      .map(link => {\r\n        const sid = typeof link.source === 'object' ? link.source.id : link.source;\r\n        const tid = typeof link.target === 'object' ? link.target.id : link.target;\r\n        const srcNode = zoneGraph.nodes.find(n => n.id === sid);\r\n        const dstNode = zoneGraph.nodes.find(n => n.id === tid);\r\n        \r\n        return {\r\n          src_IP: srcNode ? {\r\n            id: srcNode.id,\r\n            ip: srcNode.ip,\r\n            subnet: srcNode.subnet,\r\n            gateway: srcNode.gateway,\r\n            __labels: [srcNode.kind],\r\n            __id: srcNode.id,\r\n            index: srcNode.zone\r\n          } : null,\r\n          dst_IP: dstNode ? {\r\n            id: dstNode.id,\r\n            ip: dstNode.ip,\r\n            subnet: dstNode.subnet,\r\n            gateway: dstNode.gateway,\r\n            __labels: [dstNode.kind],\r\n            __id: dstNode.id,\r\n            index: dstNode.zone,\r\n            __indexColor: dstNode.color,\r\n            color: dstNode.color\r\n          } : null,\r\n          edge: {\r\n            sourceIP: sid,\r\n            targetIP: tid,\r\n            type: link.type,\r\n            count: link.count\r\n          }\r\n        };\r\n      });\r\n    \r\n    const newLog = {\r\n      message: `Zone ${zone} - 노드 선택: ${selected.label || selected.id}`,\r\n      nodeInfo: { \r\n        label: selected.label,\r\n        kind: selected.kind, \r\n        ip: selected.ip,\r\n        subnet: selected.subnet,\r\n        zone: selected.zone,\r\n        id: selected.id\r\n      },\r\n      connectedCount: connectedNodes.size,\r\n      connectedIps: connectedIps,\r\n      dbInfo: dbInfo\r\n    };\r\n    \r\n    setEventLogs([newLog]);\r\n  }, [selected, adjacency, zoneGraph.nodes, zoneGraph.links, zone, setEventLogs]);\r\n\r\n  // Custom node object with highlight and always show IP label\r\n  function nodeThreeObjectHL(node) {\r\n    const group = new THREE.Group();\r\n    const baseHex = node.color || \"#a0b4ff\";\r\n    const mat = !selected ? getBaseMat(baseHex) : (isHLNode(node) ? nodeMatCache.highlight : nodeMatCache.dim);\r\n    let mesh;\r\n    if (node.kind === \"core\") mesh = new THREE.Mesh(geoCache.torus, mat);\r\n    else if (node.kind === \"firewall\") mesh = new THREE.Mesh(geoCache.cone, mat);\r\n    else if (node.kind === \"router\") mesh = new THREE.Mesh(geoCache.cylinder, mat);\r\n    else if (node.kind === \"switch\" || node.kind === \"l2switch\") mesh = new THREE.Mesh(geoCache.box, mat);\r\n    else if (node.kind === \"l3switch\" || node.kind === \"switchrouter\" || node.kind === \"layer3\") {\r\n      const baseBox = new THREE.Mesh(geoCache.box, mat);\r\n      const topCyl = new THREE.Mesh(geoCache.l3top, mat);\r\n      topCyl.position.y = 2.6;\r\n      const g = new THREE.Group();\r\n      g.add(baseBox); g.add(topCyl);\r\n      mesh = g;\r\n    } else if (node.kind === \"hub\") mesh = new THREE.Mesh(geoCache.octa, mat);\r\n    else mesh = new THREE.Mesh(geoCache.sphere, mat);\r\n  const s = (node.kind === \"core\" ? 1.4 : Math.max(0.9, Math.min(1.8, 0.95 + (node.__deg || 0) * 0.06))) * NODE_SCALE_MULT;\r\n  mesh.scale.set(s, s, s);\r\n    mesh.castShadow = true;\r\n    mesh.receiveShadow = true;\r\n    group.add(mesh);\r\n    const led = new THREE.Mesh(geoCache.led, node.status === \"up\" ? nodeMatCache.ledUp : nodeMatCache.ledDown);\r\n  led.position.set(0, node.kind === \"core\" ? 8 * NODE_SCALE_MULT : 6 * s, 0);\r\n    group.add(led);\r\n    const hit = new THREE.Mesh(geoCache.hit, nodeMatCache.hit);\r\n    hit.name = \"hit-proxy\";\r\n    group.add(hit);\r\n    // Always show IP label above node\r\n    if (node.ip) {\r\n      const canvas = document.createElement('canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.font = 'bold 18px Arial';\r\n      const text = node.ip;\r\n      const textWidth = ctx.measureText(text).width;\r\n      canvas.width = textWidth + 16;\r\n      canvas.height = 32;\r\n      ctx.font = 'bold 18px Arial';\r\n      ctx.fillStyle = '#222';\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      ctx.fillStyle = '#fff';\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.fillText(text, canvas.width/2, canvas.height/2);\r\n      const texture = new THREE.CanvasTexture(canvas);\r\n      const spriteMat = new THREE.SpriteMaterial({ map: texture, transparent: true });\r\n      const sprite = new THREE.Sprite(spriteMat);\r\n  sprite.scale.set((canvas.width/10) * NODE_SCALE_MULT, (canvas.height/10) * NODE_SCALE_MULT, 1);\r\n      sprite.position.set(0, node.kind === \"core\" ? 15 : 10 * s, 0);\r\n      group.add(sprite);\r\n    }\r\n    return group;\r\n  }\r\n\r\n  // 그래프를 컨테이너 중앙에 항상 맞추기: 데이터/리사이즈 시 재정렬\r\n  useEffect(() => {\r\n    const recenter = () => {\r\n      try { fgRef.current && fgRef.current.zoomToFit(600, 40); } catch {}\r\n    };\r\n    // 데이터가 로드되면 맞추기\r\n    if (zoneGraph.nodes?.length || zoneGraph.links?.length) {\r\n      // 다음 프레임에 실행해 캔버스 사이즈가 반영된 후 맞춤\r\n      requestAnimationFrame(recenter);\r\n    }\r\n    // 컨테이너 리사이즈 대응\r\n    const el = graphContainerRef.current;\r\n    let ro;\r\n    if (el && typeof ResizeObserver !== 'undefined') {\r\n      ro = new ResizeObserver(() => { requestAnimationFrame(recenter); });\r\n      ro.observe(el);\r\n    } else {\r\n      window.addEventListener('resize', recenter);\r\n    }\r\n    return () => {\r\n      if (ro && el) ro.unobserve(el);\r\n      window.removeEventListener('resize', recenter);\r\n    };\r\n  }, [zoneGraph]);\r\n\r\n  // 컨테이너 정확 맞춤: graphContainerRef 크기 측정해 ForceGraph3D width/height 전달\r\n  useEffect(() => {\r\n    const el = graphContainerRef.current;\r\n    if (!el) return;\r\n    const measure = () => {\r\n      try { setContainerSize({ width: el.clientWidth || 0, height: el.clientHeight || 0 }); } catch {}\r\n    };\r\n    measure();\r\n    let ro;\r\n    if (typeof ResizeObserver !== 'undefined') {\r\n      ro = new ResizeObserver(() => measure());\r\n      try { ro.observe(el); } catch {}\r\n    } else {\r\n      window.addEventListener('resize', measure);\r\n    }\r\n    return () => {\r\n      try { if (ro && el) ro.unobserve(el); } catch {}\r\n      window.removeEventListener('resize', measure);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{ width: '100%', height: '100%', background: 'transparent', padding: 0 }}>\r\n      {/* 전체 영역: 그래프만 표시 (Inspector 제거) */}\r\n      <div style={{ flex: 1, position: 'relative', background: '#181c23', borderRadius: 12, overflow: 'hidden', height: '100%' }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 14, padding: 24 }}>\r\n          <button\r\n            onClick={onBack}\r\n            style={{ background: 'transparent', border: 'none', color: '#93c5fd', cursor: 'pointer', fontSize: 14 }}\r\n          >\r\n            ← Back\r\n          </button>\r\n          <h2 style={{ fontSize: 22, fontWeight: 700, margin: 0, color: '#fff' }}>{`Zone ${zone}`}</h2>\r\n          <div style={{ color: '#cbd5e1' }}>\r\n            {loading ? 'Loading…' : `${zoneGraph.nodes.length} nodes • ${zoneGraph.links.length} links`}\r\n          </div>\r\n        </div>\r\n        <div ref={graphContainerRef} style={{ height: 'calc(100% - 80px)', position: 'relative' }}>\r\n          <ForceGraph3D\r\n            ref={fgRef}\r\n            graphData={zoneGraph}\r\n            backgroundColor=\"#181c23\"\r\n            width={containerSize.width}\r\n            height={containerSize.height}\r\n            nodeLabel={null}\r\n            nodeThreeObject={nodeThreeObjectHL}\r\n            nodeThreeObjectExtend\r\n            linkThreeObject={linkThreeObject}\r\n            linkThreeObjectExtend={false}\r\n\r\n            //  링크 강조 강화 (색/불투명도/두께/파티클/화살표)\r\n            linkColor={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return selected ? (isIncident(l) ? '#3a6fe2' : '#87aafc') : '#87aafc';\r\n              if (!selected) return '#bfc6d4';\r\n              return isIncident(l) ? '#24a0ff' : '#5b6475';\r\n            }}\r\n            linkOpacity={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return selected ? (isIncident(l) ? 1.0 : 0.35) : 0.35;\r\n              return (!selected ? 0.35 : isIncident(l) ? 0.95 : 0.08);\r\n            }}\r\n            linkWidth={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return 0; // hide base line for logical links\r\n              return (!selected ? 1.2 : isIncident(l) ? 6 : 0.5);\r\n            }}\r\n\r\n            linkDirectionalParticles={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return 0;\r\n              return (selected && isIncident(l) ? 4 : 0);\r\n            }}\r\n            linkDirectionalParticleWidth={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return 0;\r\n              return (selected && isIncident(l) ? 5 : 0);\r\n            }}\r\n            linkDirectionalParticleSpeed={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return 0;\r\n              return (selected && isIncident(l) ? 0.006 : 0);\r\n            }}\r\n            linkDirectionalParticleColor={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return '#000000';\r\n              return (selected && isIncident(l) ? '#00e5ff' : '#000000');\r\n            }}\r\n\r\n            linkDirectionalArrowLength={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return 0;\r\n              return (selected && isIncident(l) ? 6 : 0);\r\n            }}\r\n            linkDirectionalArrowRelPos={0.6} // ★\r\n            linkDirectionalArrowColor={(l) => {\r\n              const isLogical = String(l.type || '').toLowerCase() === 'logical';\r\n              if (isLogical) return '#000000';\r\n              return (selected && isIncident(l) ? '#00e5ff' : '#000000');\r\n            }}\r\n\r\n            linkLabel={(l) => {\r\n              const sId = getId(l.source);  \r\n              const tId = getId(l.target);\r\n              const src = zoneGraph.nodes.find(n => n.id === sId);\r\n              const tgt = zoneGraph.nodes.find(n => n.id === tId);\r\n              return `IP: ${(src && src.ip) || sId} → ${(tgt && tgt.ip) || tId}`;\r\n            }}\r\n\r\n            enableNodeDrag={false}\r\n            showNavInfo={false}\r\n            cooldownTicks={60}\r\n            d3AlphaDecay={0.028}\r\n            d3VelocityDecay={0.35}\r\n            style={{ height: '100%', width: '100%' }}\r\n            onNodeClick={setSelected}\r\n            onBackgroundClick={() => {\r\n              setSelected(null);\r\n              if (setEventLogs) setEventLogs([]);\r\n            }}\r\n            onLinkClick={(l) => {\r\n              // when user clicks a link, select source node for inspector and highlight\r\n              const sid = getId(l.source);\r\n              const node = zoneGraph.nodes.find(n => n.id === sid) || zoneGraph.nodes[0];\r\n              if (node) setSelected(node);\r\n            }}\r\n            onLinkUpdate={(l, obj) => { try { const line = l.__lineObj || obj; if (line && line.computeLineDistances) line.computeLineDistances(); } catch {} }}\r\n            onEngineTick={() => {\r\n              const scene = fgRef.current?.scene?.(); if (!scene) return;\r\n              scene.traverse((obj) => { if (obj.userData?.type === 'logical-dashed' && obj.userData.link) { updateLogicalDashed(obj.userData.link, obj); } });\r\n            }}\r\n            onEngineStop={() => { const scene = fgRef.current?.scene?.(); if (!scene) return; scene.traverse((obj) => { if (obj.userData?.type === 'logical-dashed' && obj.userData.link) { updateLogicalDashed(obj.userData.link, obj); obj.visible = true; } }); }}\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["TYPE_COLORS","core","firewall","router","l3switch","switchrouter","layer3","switch","hub","server","host","default","ZonePage","zone","onBack","onInspectorChange","setEventLogs","fgRef","useRef","graphContainerRef","zoneGraph","setZoneGraph","useState","nodes","links","loading","setLoading","selected","setSelected","containerSize","setContainerSize","width","height","useEffect","mounted","res","fetch","data","json","nodesMap","Map","rawLinks","forEach","item","src_IP","id","set","String","dst_IP","edge","sourceIP","targetIP","push","source","target","nodeIds","Set","keys","filtered","filter","l","has","seen","a","b","key","type","add","Array","from","values","map","n","kind","toLowerCase","label","ip","color","status","subnet","includes","split","slice","join","zoneNum","Number","isFinite","e","geoCache","useMemo","torus","THREE.TorusGeometry","cone","THREE.ConeGeometry","cylinder","THREE.CylinderGeometry","box","THREE.BoxGeometry","l3top","sphere","THREE.SphereGeometry","led","hit","octa","THREE.OctahedronGeometry","dashUnit","nodeMatCache","base","highlight","THREE.MeshStandardMaterial","metalness","roughness","dim","ledUp","THREE.MeshBasicMaterial","ledDown","opacity","transparent","depthWrite","dashedBase","polygonOffset","polygonOffsetFactor","dashedInc","enhanceDashMesh","mesh","renderOrder","material","placeCylinderBetween","radius","dir","THREE.Vector3","subVectors","L","length","visible","mid","addVectors","multiplyScalar","position","copy","quaternion","setFromUnitVectors","clone","normalize","scale","hashId","s","h","i","charCodeAt","updateLogicalDashed","group","srcObj","find","tgtObj","start","x","y","z","end","estimateClearance","node","deg","__deg","Math","max","min","cStart","cEnd","totalVec","totalLen","curve","curvature","rotation","v","len","abs","perp","crossVectors","applyAxisAngle","amp","ctrl","THREE.QuadraticBezierCurve3","getCurve","getId","linkCurveRotation","dashCount","geo","matBase","matInc","userData","dashes","cur","m","THREE.Mesh","castShadow","receiveShadow","pop","remove","geometry","dispose","ensureDashMeshes","incident","mat","EPS","capTrim","baseT0","baseT1","dashRatio","t0","t1","getPoint","adjacency","get","__id","isIncident","connectedNodes","connectedIps","nid","dbInfo","link","sid","tid","srcNode","dstNode","gateway","__labels","index","__indexColor","count","newLog","message","nodeInfo","connectedCount","size","recenter","current","zoomToFit","requestAnimationFrame","el","ro","ResizeObserver","observe","window","addEventListener","unobserve","removeEventListener","measure","clientWidth","clientHeight","jsx","style","background","padding","children","jsxs","flex","borderRadius","overflow","display","alignItems","gap","marginBottom","onClick","border","cursor","fontSize","fontWeight","margin","ref","ForceGraph3D","graphData","backgroundColor","nodeLabel","nodeThreeObject","THREE.Group","baseHex","hex","THREE.Color","getBaseMat","baseBox","topCyl","g","name","canvas","document","createElement","ctx","getContext","font","text","textWidth","measureText","fillStyle","fillRect","textAlign","textBaseline","fillText","texture","THREE.CanvasTexture","spriteMat","THREE.SpriteMaterial","sprite","THREE.Sprite","nodeThreeObjectExtend","linkThreeObject","linkThreeObjectExtend","linkColor","linkOpacity","linkWidth","linkDirectionalParticles","linkDirectionalParticleWidth","linkDirectionalParticleSpeed","linkDirectionalParticleColor","linkDirectionalArrowLength","linkDirectionalArrowRelPos","linkDirectionalArrowColor","linkLabel","sId","tId","src","tgt","enableNodeDrag","showNavInfo","cooldownTicks","d3AlphaDecay","d3VelocityDecay","onNodeClick","onBackgroundClick","onLinkClick","onLinkUpdate","obj","line","__lineObj","computeLineDistances","onEngineTick","scene","traverse","onEngineStop"],"mappings":"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"}