import{j as e}from"./mui-vendor-BCY2i4tN.js";import{c as r,a as t}from"./react-vendor-D7TXN3SA.js";import{N as o}from"./vis-network-CqERLR1V.js";import"./index-D1-d0E8K.js";import"./index-CDaHbTyd.js";import"./chart-vendor-_i8yG59r.js";import"./three-vendor-C-R8GBcK.js";import"./TargetIdentification-Bn1Mapah.js";import"./TargetPriority-6OTwCS7v.js";function s(e){return"switch"===e.type?"/image/switch.png":"workstation"===e.type?"/image/workstation.png":"server"===e.type?"/image/server.png":"router"===e.type?"/image/router.png":"firewall"===e.type?"/image/firewall.png":"laptop"===e.type?"/image/laptop.png":"printer"===e.type?"/image/printer.png":"sensor"===e.type?"/image/sensor.png":"plc"===e.type?"/image/plc.png":"/logo192.png"}const n=r.memo(({dbNodes:n=[],onNodeClick:i,filterConditions:d})=>{const a=t.useRef(null),c=t.useRef(null),p=r.useCallback(e=>String(e?.__id??e?.id??e?.ip??e?.index??JSON.stringify(e)),[]),{nodes:l,edges:g}=r.useMemo(()=>{const e=[],r=[];return n.forEach(e=>{if(e.edge&&e.src_IP&&e.dst_IP){const o=p(e.src_IP),s=p(e.dst_IP),n="number"==typeof e.src_IP.degree_score?e.src_IP.degree_score:null;let i="solid";if(n<=.5&&(i="dashed"),"direct"===d?.connectionType&&!(n>.5))return;if("indirect"===d?.connectionType&&!(n>0&&n<=.5))return;const a={dashes:"dashed"===(t={...e.edge,edgeType:i}).edgeType||!0===t.isDashed,color:t.color||"#333",width:t.width||2,arrows:t.arrows||"to"};r.push({from:o,to:s,length:100+200*Math.random(),...a})}var t}),n.forEach(r=>{[r.src_IP,r.dst_IP].forEach(r=>{const t=p(r);if(r&&!e.some(e=>e.id===t)){const o=s(r),n=14,i=50;let d=.5;"number"==typeof r.degree_score&&"number"==typeof r.con_score&&(d=r.degree_score+r.con_score,d=Math.max(0,Math.min(1,d)));const a=n+(i-n)*d;e.push({id:t,label:r.label||r.ip||t,shape:"image",image:o,size:a})}})}),{nodes:e,edges:r}},[n,p,d]);return t.useEffect(()=>{const e={nodes:l,edges:g},r={layout:{randomSeed:1},nodes:{shape:"image",brokenImage:s({}),size:30,borderWidth:2,color:{border:"#b39ddb"},font:{size:18,color:"#222"}},edges:{},physics:!0};return a.current&&!c.current&&(c.current=new o(a.current,e,r),c.current.on("click",function(e){if(e.nodes&&e.nodes.length>0){const r=e.nodes[0],t=l.find(e=>e.id===r),o=new Set,s=[r];for(;s.length>0;){const e=s.shift();o.has(e)||(o.add(e),g.forEach(r=>{r.from!==e||o.has(r.to)||s.push(r.to),r.to!==e||o.has(r.from)||s.push(r.from)}))}const d=Array.from(o).filter(e=>e!==r),a=d.length,c=new Set;d.forEach(e=>{const r=l.find(r=>r.id===e);r?.label&&c.add(r.label),r?.ip&&c.add(r.ip)});let m=t?.ip||t?.label;const f=Array.from(c).filter(e=>e!==m),u=n.find(e=>p(e.src_IP)===r||p(e.dst_IP)===r);i&&i({...t,connectedCount:a,connectedIps:f,dbInfo:u?[{src_IP:u.src_IP,dst_IP:u.dst_IP,edge:u.edge}]:[]})}})),()=>{c.current&&(c.current.destroy(),c.current=null)}},[n,l,g]),e.jsx("div",{className:"target-graph-canvas",ref:a})});n.displayName="TargetGraph2D";export{n as default};
