{"version":3,"file":"index-D5mnE7mZ.js","sources":["../../../miraedojeon/front/src/pages/CyberObjectInfo/Multilayer/3layer_Log.jsx","../../../miraedojeon/front/src/pages/CyberObjectInfo/Multilayer/MultilayerVisualization.jsx"],"sourcesContent":["import React, { memo } from \"react\";\r\nimport { Card, CardContent, Typography } from '@mui/material';\r\n\r\nconst InternalLog = memo(({ eventLogs = [] }) => {\r\n  return (\r\n      <Card elevation={0} sx={{\r\n        minWidth: 350,\r\n        width: 300,\r\n        bgcolor: '#f0edfd',\r\n        color: '#000',\r\n        border: '1px solid #d0c9f0',\r\n        // boxShadow removed\r\n        borderRadius: '20px',\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        flexShrink: 0,\r\n        height: '100%'\r\n      }}>\r\n        <CardContent sx={{ p: 2, display: 'flex', flexDirection: 'column', gap: 2, flex: 1, minHeight: 0 }}>\r\n          <Typography variant=\"subtitle1\" sx={{ fontWeight: 700, color: '#39306b', mb: 1 }}>이벤트 로그</Typography>\r\n          <div style={{ flex: 1, overflowY: 'auto', minHeight: 0 }}>\r\n          {eventLogs.length === 0 ? (\r\n            <div style={{ color: '#666', fontSize: '14px', padding: '10px' }}>\r\n              노드를 클릭하면 이벤트 로그가 표시됩니다.\r\n            </div>\r\n          ) : (\r\n            eventLogs.map((log, idx) => (\r\n              <div key={idx} style={{\r\n                padding: '10px',\r\n                marginBottom: '8px',\r\n                background: 'rgba(57, 48, 107, 0.1)',\r\n                borderRadius: '8px',\r\n                fontSize: '13px',\r\n                color: '#333'\r\n              }}>\r\n                {log.message && <div style={{ fontWeight: 600, marginBottom: '4px', color: '#222' }}>{log.message}</div>}\r\n                {log.nodeInfo && (\r\n                  <div style={{ fontSize: '11px', color: '#666', marginTop: '4px' }}>\r\n                    Layer: {log.nodeInfo.layer} | Type: {log.nodeInfo.type}\r\n                  </div>\r\n                )}\r\n\r\n                {/* 연결된 노드 개수 */}\r\n                {log.connectedCount !== undefined && (\r\n                  <div style={{ marginTop: '8px', marginBottom: '8px', color: '#222' }}>\r\n                    연결된 노드 개수: {log.connectedCount}\r\n                    {Array.isArray(log.connectedIps) && log.connectedIps.length > 0 && (\r\n                      <details style={{ marginTop: '4px', color: '#222' }}>\r\n                        <summary style={{ cursor: 'pointer', color: '#1976d2', fontWeight: 'bold' }}>연결된 노드 IP 목록 보기</summary>\r\n                        <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                          {log.connectedIps.map((ip, i) => (\r\n                            <li key={ip + i} style={{ color: '#222' }}>{ip}</li>\r\n                          ))}\r\n                        </ul>\r\n                      </details>\r\n                    )}\r\n                  </div>\r\n                )}\r\n\r\n                {/* dbInfo 배열 출력 - 하나의 카드로 통합 */}\r\n                {Array.isArray(log.dbInfo) && log.dbInfo.length > 0 && log.dbInfo.map((info, i) => (\r\n                  <Card key={i} elevation={0} sx={{\r\n                    bgcolor: 'rgba(255,255,255,0.6)',\r\n                    border: '1px solid rgba(124,58,237,0.18)',\r\n                    borderRadius: 2,\r\n                    mt: 1\r\n                  }}>\r\n                    <CardContent sx={{ py: 1.25, px: 1.5 }}>\r\n                      {(() => {\r\n                        const srcLabel = String(info?.src_IP?.__labels?.[0] || '').toLowerCase();\r\n                        const srcIsPhysical = srcLabel === 'physical';\r\n                        const srcIsLogical = srcLabel === 'logical';\r\n                        if (srcIsPhysical) {\r\n                          return (\r\n                            <>\r\n                              {/* Src Node (physical) */}\r\n                              {info.src_IP && (\r\n                                <div style={{ marginBottom: '12px' }}>\r\n                                  <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Src Node</Typography>\r\n                                  <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                    {[\r\n                                      ['name', info.src_IP.name],\r\n                                      ['type', info.src_IP.type],\r\n                                      ['ip', info.src_IP.ip],\r\n                                      ['subnet', info.src_IP.subnet],\r\n                                      ['dns', info.src_IP.dns],\r\n                                      ['gateway', info.src_IP.gateway]\r\n                                    ].filter(([, v]) => v !== undefined && v !== null && v !== '').map(([k, v]) => (\r\n                                      <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {String(v)}</li>\r\n                                    ))}\r\n                                  </ul>\r\n                                </div>\r\n                              )}\r\n\r\n                              {/* Dst Node (logical-like) */}\r\n                              {info.dst_IP && (\r\n                                <div style={{ marginBottom: '12px' }}>\r\n                                  <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Dst Node</Typography>\r\n                                  <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                    {[\r\n                                      ['name', info.dst_IP.name],\r\n                                      ['description', info.dst_IP.description],\r\n                                      ['cve', info.dst_IP.cve]\r\n                                    ].filter(([, v]) => v !== undefined && v !== null && v !== '').map(([k, v]) => (\r\n                                      <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {String(v)}</li>\r\n                                    ))}\r\n                                  </ul>\r\n                                </div>\r\n                              )}\r\n\r\n                              {/* Edge (rel, SrcID, targetID) */}\r\n                              {info.edge && (\r\n                                <div>\r\n                                  <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Edge Info</Typography>\r\n                                  <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                    {[\r\n                                      ['rel', info.edge.rel || info.edge.kind],\r\n                                      ['SrcID', info.edge.sourceIP],\r\n                                      ['TargetID', info.edge.targetIP]\r\n                                    ].map(([k, v]) => {\r\n                                      const display = Array.isArray(v) ? v.join(', ') : String(v);\r\n                                      return (\r\n                                        <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {display}</li>\r\n                                      );\r\n                                    })}\r\n                                  </ul>\r\n                                </div>\r\n                              )}\r\n                            </>\r\n                          );\r\n                        }\r\n\r\n                        // Logical src mapping\r\n                        if (srcIsLogical) {\r\n                          return (\r\n                            <>\r\n                              {/* Src Node (logical) */}\r\n                              {info.src_IP && (\r\n                                <div style={{ marginBottom: '12px' }}>\r\n                                  <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Src Node</Typography>\r\n                                  <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                    {[\r\n                                      ['name', info.src_IP.name],\r\n                                      ['description', info.src_IP.description],\r\n                                      ['cve', info.src_IP.cve]\r\n                                    ].filter(([, v]) => v !== undefined && v !== null && v !== '').map(([k, v]) => {\r\n                                      const display = Array.isArray(v) ? v.join(', ') : String(v);\r\n                                      return (\r\n                                        <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {display}</li>\r\n                                      );\r\n                                    })}\r\n                                  </ul>\r\n                                </div>\r\n                              )}\r\n\r\n                              {/* Dst Node (logical) - KV vs Entity 구분 */}\r\n                              {info.dst_IP && (\r\n                                <div style={{ marginBottom: '12px' }}>\r\n                                  <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Dst Node</Typography>\r\n                                  <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                    {(() => {\r\n                                      const isKV = info.dst_IP.key !== undefined || info.dst_IP.value !== undefined;\r\n                                      const pairs = isKV\r\n                                        ? [\r\n                                            ['id', info.dst_IP.id],\r\n                                            ['key', info.dst_IP.key],\r\n                                            ['value', info.dst_IP.value]\r\n                                          ]\r\n                                        : [\r\n                                            ['name', info.dst_IP.name],\r\n                                            ['description', info.dst_IP.description],\r\n                                            ['cve', info.dst_IP.cve]\r\n                                          ];\r\n                                      return pairs\r\n                                        .filter(([, v]) => v !== undefined && v !== null && v !== '')\r\n                                        .map(([k, v]) => {\r\n                                          const display = Array.isArray(v) ? v.join(', ') : String(v);\r\n                                          return (\r\n                                            <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {display}</li>\r\n                                          );\r\n                                        });\r\n                                    })()}\r\n                                  </ul>\r\n                                </div>\r\n                              )}\r\n\r\n                              {/* Edge (rel, SrcID, targetID) */}\r\n                              {info.edge && (\r\n                                <div>\r\n                                  <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Edge Info</Typography>\r\n                                  <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                    {[\r\n                                      ['rel', info.edge.rel || info.edge.kind],\r\n                                      ['SrcID', info.edge.sourceIP],\r\n                                      ['TargetID', info.edge.targetIP]\r\n                                    ].map(([k, v]) => {\r\n                                      const display = Array.isArray(v) ? v.join(', ') : String(v);\r\n                                      return (\r\n                                        <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {display}</li>\r\n                                      );\r\n                                    })}\r\n                                  </ul>\r\n                                </div>\r\n                              )}\r\n                            </>\r\n                          );\r\n                        }\r\n\r\n                        // Default: show minimal IDs when type unknown\r\n                        return (\r\n                          <>\r\n                            {info.src_IP && (\r\n                              <div style={{ marginBottom: '12px' }}>\r\n                                <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Src Node</Typography>\r\n                                <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                  {[['id', info.src_IP.id]].map(([k, v]) => (\r\n                                    <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {String(v)}</li>\r\n                                  ))}\r\n                                </ul>\r\n                              </div>\r\n                            )}\r\n                            {info.dst_IP && (\r\n                              <div style={{ marginBottom: '12px' }}>\r\n                                <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Dst Node</Typography>\r\n                                <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                  {[['id', info.dst_IP.id]].map(([k, v]) => {\r\n                                    const display = Array.isArray(v) ? v.join(', ') : String(v);\r\n                                    return (\r\n                                      <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {display}</li>\r\n                                    );\r\n                                  })}\r\n                                </ul>\r\n                              </div>\r\n                            )}\r\n                            {info.edge && (\r\n                              <div>\r\n                                <Typography variant=\"subtitle2\" sx={{ color: '#3b2c6b', fontWeight: 700, mb: 0.5 }}>Edge Info</Typography>\r\n                                <ul style={{ margin: 0, paddingLeft: 16 }}>\r\n                                  {[\r\n                                    ['rel', info.edge.rel || info.edge.kind],\r\n                                    ['SrcID', info.edge.sourceIP],\r\n                                    ['TargetID', info.edge.targetIP]\r\n                                  ].map(([k, v]) => {\r\n                                    const display = Array.isArray(v) ? v.join(', ') : String(v);\r\n                                    return (\r\n                                      <li key={k} style={{ color: '#2a2050' }}><b style={{ color: '#6553a7' }}>{k}:</b> {display}</li>\r\n                                    );\r\n                                  })}\r\n                                </ul>\r\n                              </div>\r\n                            )}\r\n                          </>\r\n                        );\r\n                      })()}\r\n                    </CardContent>\r\n                  </Card>\r\n                ))}\r\n              </div>\r\n            ))\r\n          )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n});\r\n\r\nInternalLog.displayName = 'InternalLog';\r\n\r\nexport default InternalLog;\r\n","import React, { useEffect, useMemo, useRef, useState } from 'react';\r\nimport { Card, CardContent, Typography, IconButton } from '@mui/material';\r\nimport { ClusterOutlined } from '@ant-design/icons';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport ForceGraph3D from 'react-force-graph-3d';\r\nimport * as THREE from 'three';\r\nimport ThreelayerLog from './3layer_Log.jsx';\r\n\r\n// ===================== 상수 =====================\r\nconst STATUS = ['up', 'down', 'unknown'];\r\nconst LAYER_COLORS = { physical: '#3BA3FF', logical: '#9B6BFF', persona: '#FF9E3B' };\r\nconst LAYOUT = {\r\n  nodeSpread: 800,        // x/y 기본 분포 반경\r\n  layerZ: { physical: -600, logical: 0, persona: 600 }, // 레이어별 z 분리 증가\r\n  plane: { width: 2000, height: 1400 }, // 레이어 평면 크기 확대\r\n  subnetRadius: 420      // 서브넷 클러스터 배치 반경\r\n};\r\nconst KIND_COLORS = {\r\n  CONNECTS_TO: '#A0AEC0',\r\n  CONNECTED: '#A0AEC0',\r\n  HOSTS: '#60A5FA',\r\n  USES: '#F59E0B',\r\n  IN_SUBNET: '#93C5FD',\r\n  IN_VLAN: '#C084FC',\r\n  MEMBER_OF: '#FBBF24'\r\n};\r\n\r\n// 백엔드 API 베이스\r\nconst API_BASE = (typeof process !== 'undefined' && process.env && process.env.REACT_APP_API_BASE) || 'http://localhost:8000';\r\nconst PROJECT_FILTER = 'multi-layer'; // 또는 null\r\n\r\n// ===================== 유틸 =====================\r\nconst isCrossLayer = (a, b) => a.layer !== b.layer;\r\n\r\n// CVE 추출 유틸\r\nfunction extractCVE(node) {\r\n  if (!node) return [];\r\n  const toArray = (v) => (v == null ? [] : Array.isArray(v) ? v : [v]);\r\n  const out = new Set();\r\n  const pullFromObject = (obj) => {\r\n    if (!obj || typeof obj !== 'object') return '';\r\n    return (\r\n      obj.cve || obj.CVE || obj.id || obj.value || obj.name || obj.key || obj.description || ''\r\n    );\r\n  };\r\n  const cveRegex = /CVE-\\d{4}-\\d+/gi;\r\n  const addVals = (vals) => {\r\n    toArray(vals).forEach((x) => {\r\n      const raw = typeof x === 'string' ? x : pullFromObject(x);\r\n      const s = String(raw || '').trim();\r\n      if (!s) return;\r\n      const matches = s.match(cveRegex);\r\n      if (matches) matches.forEach((m) => out.add(m.toUpperCase()));\r\n      else if (s.toUpperCase().includes('CVE')) out.add(s.toUpperCase());\r\n    });\r\n  };\r\n  addVals(node.cve);\r\n  addVals(node.CVE);\r\n  addVals(node.cves);\r\n  addVals(node.CVEs);\r\n  addVals(node.cve_list);\r\n  addVals(node.vulns);\r\n  addVals(node.vulnerabilities);\r\n  addVals(node.vulnerability);\r\n  addVals(node.tags);\r\n  addVals(node.description);\r\n  return Array.from(out);\r\n}\r\n\r\n// ===================== 정규화: Node/Edge =====================\r\nfunction normalizeNode(raw) {\r\n  // __labels / layer 속성 기반으로 레이어 판정\r\n  const labelsLower = (raw.__labels || []).map(s => String(s).toLowerCase());\r\n  let layer =\r\n    (raw.layer && String(raw.layer).toLowerCase()) ||\r\n    (labelsLower.includes('persona') ? 'persona'\r\n      : (labelsLower.includes('logical') || labelsLower.includes('service') || labelsLower.includes('subnet') || labelsLower.includes('vlan')) ? 'logical'\r\n      : (labelsLower.includes('physical') || labelsLower.includes('device') || labelsLower.includes('host')) ? 'physical'\r\n      : 'physical');\r\n\r\n  // type/label 기본값\r\n  let type = (raw.type || labelsLower[0] || 'device').toString().toLowerCase();\r\n  let label = raw.label || raw.hostname || raw.name || raw.user_name || raw.service_name || raw.subnet || raw.ip || raw.id;\r\n  if (!label && raw.vlan !== undefined) label = `VLAN-${raw.vlan}`;\r\n\r\n    return {\r\n    id: raw.id,\r\n    layer,\r\n    type,\r\n    label: label || String(raw.id || ''),\r\n    status: raw.status || 'up',\r\n    severity: typeof raw.severity === 'number' ? raw.severity : 0,\r\n    ip: raw.ip,\r\n    hostname: raw.hostname,\r\n    os: raw.os,\r\n    subnet: raw.subnet,\r\n  // ensure optional fields propagate for EventLog rendering\r\n  dns: raw.dns,\r\n  gateway: raw.gateway,\r\n  description: raw.description,\r\n  value: raw.value,\r\n  key: raw.key,\r\n  cve: raw.cve,\r\n  cves: raw.cves,\r\n  cve_list: raw.cve_list,\r\n  vulns: raw.vulns,\r\n  vulnerabilities: raw.vulnerabilities,\r\n    service_name: raw.service_name,\r\n    proto: raw.proto,\r\n    port: raw.port,\r\n    vlan: raw.vlan,\r\n    user_name: raw.user_name,\r\n    role: raw.role,\r\n    dept: raw.dept,\r\n    device_ids: raw.device_ids || [],\r\n    tags: raw.tags || [],\r\n  // 초기 위치 (레이어별 z 고정) — 노드를 레이어 평면 영역에 골고루 분포시킴\r\n  x: (Math.random() - 0.5) * LAYOUT.plane.width * 0.9,\r\n  y: (Math.random() - 0.5) * LAYOUT.plane.height * 0.9,\r\n    z: layer === 'persona' ? LAYOUT.layerZ.persona : layer === 'logical' ? LAYOUT.layerZ.logical : LAYOUT.layerZ.physical\r\n  };\r\n}\r\n\r\nfunction normalizeEdge(rawEdge) {\r\n  if (!rawEdge) return null;\r\n  // 백엔드가 edge.rel = \"HOSTS\" | \"USES\" 를 줄 수 있음. 없으면 기존 필드도 시도\r\n  let kind = rawEdge.kind || rawEdge.rel || rawEdge.type || 'CONNECTS_TO';\r\n  if (kind === 'CONNECTED') kind = 'CONNECTS_TO';\r\n  return {\r\n    source: rawEdge.sourceIP,\r\n    target: rawEdge.targetIP,\r\n    kind,\r\n    assumed: Boolean(rawEdge.assumed),\r\n    confidence: typeof rawEdge.confidence === 'number' ? rawEdge.confidence : undefined,\r\n    __sid: rawEdge.sourceIP,\r\n    __tid: rawEdge.targetIP\r\n  };\r\n}\r\n\r\n// ===================== 레코드 → 그래프 =====================\r\nfunction mergeRecordsToGraph(allRecords) {\r\n  const nodesMap = new Map();\r\n  const links = [];\r\n\r\n  for (const rec of allRecords) {\r\n    const sRaw = rec.src_IP || rec.n || rec.source; \r\n    const tRaw = rec.dst_IP || rec.t || rec.target; \r\n    const eRaw = rec.edge || rec.r; \r\n    if (!sRaw || !tRaw) continue;\r\n    const sid = sRaw.id; const tid = tRaw.id;\r\n    if (!sid || !tid) continue;\r\n    if (!nodesMap.has(sid)) nodesMap.set(sid, normalizeNode(sRaw));\r\n    if (!nodesMap.has(tid)) nodesMap.set(tid, normalizeNode(tRaw));\r\n    const e = normalizeEdge(eRaw);\r\n    if (e) links.push(e);\r\n  }\r\n\r\n  // 서브넷 클러스터 근처로 물리 노드 살짝 재배치\r\n  const nodes = [...nodesMap.values()];\r\n  const subs = nodes.filter(n => n.type === 'subnet');\r\n  const devs = nodes.filter(n => n.layer === 'physical');\r\n  const subnetCenters = new Map();\r\n  subs.forEach((s, i) => {\r\n    const angle = (i / Math.max(1, subs.length)) * Math.PI * 2;\r\n    const radius = LAYOUT.subnetRadius;\r\n    subnetCenters.set(s.subnet || s.label || s.id, { cx: Math.cos(angle) * radius, cy: Math.sin(angle) * radius });\r\n  });\r\n  devs.forEach(d => {\r\n    const key = d.subnet || d.label;\r\n    const c = subnetCenters.get(key);\r\n    if (c) { d.x = c.cx + (Math.random() - 0.5) * 50; d.y = c.cy + (Math.random() - 0.5) * 50; }\r\n  });\r\n\r\n  return { nodes, links };\r\n}\r\n\r\n// ===================== 데이터 페치 =====================\r\nasync function fetchThreeLayer(project) {\r\n  const url = `${API_BASE}/neo4j/nodes?activeView=multilayer${project ? `&project=${encodeURIComponent(project)}` : ''}`;\r\n  const res = await fetch(url);\r\n  if (!res.ok) throw new Error(`API multilayer 실패: ${res.status}`);\r\n  return res.json(); // [{src_IP, dst_IP, edge}, ...]\r\n}\r\n\r\n// ===================== 인접 계산 =====================\r\nfunction buildAdjacency(nodes, links) {\r\n  const byId = Object.fromEntries(nodes.map(n => [n.id, n]));\r\n  const adj = new Map(); nodes.forEach(n => adj.set(n.id, new Set()));\r\n  links.forEach(l => {\r\n    const s = typeof l.source === 'object' ? l.source.id : l.source;\r\n    const t = typeof l.target === 'object' ? l.target.id : l.target;\r\n    if (adj.has(s)) adj.get(s).add(t);\r\n    if (adj.has(t)) adj.get(t).add(s);\r\n    l.__sid = s; l.__tid = t; l.__s = byId[s]; l.__t = byId[t];\r\n  });\r\n  return { byId, adj };\r\n}\r\n\r\n// ===================== 폴백 모킹 =====================\r\nfunction generateMockGraph() {\r\n  const nodes = [];\r\n  const links = [];\r\n  for (let i = 0; i < 30; i++) nodes.push({ id: `dev-${i}`, layer: 'physical', type: 'server', label: `DEV-${i}`, status: 'up', severity: 0, x: (Math.random()-0.5)*LAYOUT.nodeSpread, y: (Math.random()-0.5)*LAYOUT.nodeSpread, z: LAYOUT.layerZ.physical });\r\n  for (let i = 0; i < 10; i++) nodes.push({ id: `svc-${i}`, layer: 'logical', type: 'service', label: `SVC-${i}`, status: 'up', severity: 0, x: (Math.random()-0.5)*LAYOUT.nodeSpread, y: (Math.random()-0.5)*LAYOUT.nodeSpread, z: LAYOUT.layerZ.logical });\r\n  for (let i = 0; i < 10; i++) nodes.push({ id: `user-${i}`, layer: 'persona', type: 'user', label: `USER-${i}`, status: 'up', severity: 0, x: (Math.random()-0.5)*LAYOUT.nodeSpread, y: (Math.random()-0.5)*LAYOUT.nodeSpread, z: LAYOUT.layerZ.persona });\r\n  for (let i = 0; i < 80; i++) links.push({ source: `dev-${Math.floor(Math.random()*30)}`, target: `svc-${Math.floor(Math.random()*10)}`, kind: 'HOSTS' });\r\n  for (let i = 0; i < 80; i++) links.push({ source: `user-${Math.floor(Math.random()*10)}`, target: `svc-${Math.floor(Math.random()*10)}`, kind: 'USES' });\r\n  return { nodes, links };\r\n}\r\n\r\n// ===================== 상세 패널 =====================\r\nfunction NodeDetailPanel({ selected, adj, visible, byId, onClearSelection, onResetView }) {\r\n  if (!selected) {\r\n    return (\r\n      <div style={{ padding: 16, color: '#d1d5db', fontSize: 14 }}>\r\n        <div style={{ fontWeight: 600, marginBottom: 8 }}>선택된 노드가 없습니다</div>\r\n        노드를 클릭하면 상세 정보와 연결 리스트가 여기에 표시됩니다.\r\n      </div>\r\n    );\r\n  }\r\n  return (\r\n    <>\r\n      <div style={{ padding: 16, borderBottom: '1px solid rgba(255,255,255,0.1)' }}>\r\n        <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 12, color: '#fff' }}>기본 정보</div>\r\n        <div style={{ display: 'grid', rowGap: 6, color: '#e5e7eb', fontSize: 13 }}>\r\n          <div><b>ID:</b> <span style={{ wordBreak: 'break-all' }}>{selected.id}</span></div>\r\n          <div><b>Layer:</b> {selected.layer}</div>\r\n          <div><b>Type:</b> {selected.type}</div>\r\n          <div><b>Label:</b> {selected.label}</div>\r\n          <div><b>Status:</b> {selected.status}</div>\r\n          <div><b>Severity:</b> {selected.severity}</div>\r\n          {Array.isArray(selected.tags) && selected.tags.length > 0 && (<div><b>Tags:</b> {selected.tags.join(', ')}</div>)}\r\n        </div>\r\n      </div>\r\n      <ConnLists selectedId={selected.id} visible={visible} adj={adj} byId={byId} />\r\n      <div style={{ padding: 12, borderTop: '1px solid rgba(255,255,255,0.1)', display: 'flex', gap: 8 }}>\r\n        <button onClick={onClearSelection} style={{ padding: '4px 8px', background: '#374151', color: '#fff', border: 'none', borderRadius: 6 }}>선택 해제</button>\r\n        <button onClick={onResetView} style={{ padding: '4px 8px', background: '#374151', color: '#fff', border: 'none', borderRadius: 6 }}>전체 보기</button>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction ConnLists({ selectedId, visible, byId, adj }) {\r\n  return (\r\n    <div style={{ padding: 16, flex: 1, overflow: 'auto' }}>\r\n      <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 8, color: '#fff' }}>동일 레이어 연결</div>\r\n      <ConnList listType=\"same\" selectedId={selectedId} visible={visible} byId={byId} adj={adj} />\r\n      <div style={{ height: 12 }} />\r\n      <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 8, color: '#fff' }}>교차 레이어 연결</div>\r\n      <ConnList listType=\"cross\" selectedId={selectedId} visible={visible} byId={byId} adj={adj} />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction ConnList({ listType, selectedId, visible, byId, adj }) {\r\n  const items = [];\r\n  if (selectedId && byId[selectedId]) {\r\n    (adj.get(selectedId) || []).forEach(nid => {\r\n      const l = visible.links.find(lnk => {\r\n        const s = lnk.__sid || (typeof lnk.source === 'object' ? lnk.source.id : lnk.source);\r\n        const t = lnk.__tid || (typeof lnk.target === 'object' ? lnk.target.id : lnk.target);\r\n        return (s === selectedId && t === nid) || (t === selectedId && s === nid);\r\n      });\r\n      const other = byId[nid];\r\n      if (!l || !other) return;\r\n      const cross = other.layer !== byId[selectedId].layer;\r\n      if ((listType === 'same' && !cross) || (listType === 'cross' && cross)) items.push({ l, other });\r\n    });\r\n  }\r\n  if (!items.length) return <div style={{ fontSize: 12, color: '#9ca3af' }}>없음</div>;\r\n  return (\r\n    <div>\r\n      {items.map((it, i) => (\r\n        <div key={i} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '4px 0', borderBottom: '1px solid rgba(55,65,81,0.5)', fontSize: 12 }}>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            <span style={{ width: 8, height: 8, borderRadius: 4, background: LAYER_COLORS[it.other.layer] }} />\r\n            <span style={{ color: '#e5e7eb' }}>{it.other.label}</span>\r\n            <span style={{ color: '#9ca3af' }}>({it.other.type})</span>\r\n          </div>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n            {it.l.assumed && <span style={{ background: '#374151', color: '#e5e7eb', padding: '2px 6px', borderRadius: 4, fontSize: 10 }}>assumed</span>}\r\n            <span style={{ color: '#9ca3af' }}>{it.l.kind}</span>\r\n          </div>\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n// ===================== 메인 컴포넌트 =====================\r\nexport default function CyberMultiLayer3D({ onNodeSelect = () => {}, onInspectorChange = () => {} }) {\r\n  const fgRef = useRef();\r\n  const containerRef = useRef(null);\r\n  const graphContainerRef = useRef(null);\r\n  const [containerSize, setContainerSize] = useState({ width: 0, height: 0 });\r\n\r\n  const [graphData, setGraphData] = useState({ nodes: [], links: [] });\r\n  const [pulse, setPulse] = useState(false);\r\n  const [selectedId, setSelectedId] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [search, setSearch] = useState('');\r\n  const [layerFilter, setLayerFilter] = useState({ physical: true, logical: true, persona: true });\r\n  const [assumedFilter, setAssumedFilter] = useState('all');\r\n  const [statusFilter, setStatusFilter] = useState(new Set(STATUS));\r\n  const [eventLogs, setEventLogs] = useState([]);\r\n\r\n  const { byId, adj } = useMemo(() => buildAdjacency(graphData.nodes, graphData.links), [graphData]);\r\n\r\n  // 레이어 플레인\r\n  const addLayerPlanes = () => {\r\n    const scene = fgRef.current?.scene?.(); if (!scene) return;\r\n    const existing = scene.getObjectByName('layer-planes'); if (existing) scene.remove(existing);\r\n    const group = new THREE.Group(); group.name = 'layer-planes';\r\n    const makePlane = (z, color, label) => {\r\n      const planeGeo = new THREE.PlaneGeometry(LAYOUT.plane.width, LAYOUT.plane.height, 1, 1);\r\n      const mat = new THREE.MeshBasicMaterial({ color, transparent: true, opacity: 0.06, depthWrite: false });\r\n      const mesh = new THREE.Mesh(planeGeo, mat); mesh.position.set(0, 0, z);\r\n      const edges = new THREE.EdgesGeometry(planeGeo);\r\n      const line = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color, transparent: true, opacity: 0.25 }));\r\n      line.position.set(0, 0, z + 0.1);\r\n  const canvas = document.createElement('canvas'); canvas.width = 512; canvas.height = 128; const ctx = canvas.getContext('2d');\r\n  ctx.fillStyle = 'rgba(0,0,0,0)'; ctx.fillRect(0,0,512,128); ctx.font = '40px sans-serif'; ctx.fillStyle = '#ffffff'; ctx.textAlign = 'left'; ctx.textBaseline = 'middle'; ctx.fillText(label, 14, 64);\r\n  const tex = new THREE.CanvasTexture(canvas); const sprMat = new THREE.SpriteMaterial({ map: tex, transparent: true, opacity: 0.9, depthWrite: false });\r\n  const sprite = new THREE.Sprite(sprMat); sprite.scale.set(320, 80, 1);\r\n  // 평면 영역의 좌상단에 레이블 표시 (여백 포함)\r\n  sprite.position.set(-LAYOUT.plane.width/2 + 180, LAYOUT.plane.height/2 - 80, z + 0.2);\r\n      group.add(mesh); group.add(line); group.add(sprite);\r\n    };\r\n  makePlane(LAYOUT.layerZ.physical, LAYER_COLORS.physical, 'Physical');\r\n  makePlane(LAYOUT.layerZ.logical,  LAYER_COLORS.logical,  'Logical');\r\n  makePlane(LAYOUT.layerZ.persona,  LAYER_COLORS.persona,  'Persona');\r\n    scene.add(group);\r\n  };\r\n  const toggleLayerPlanes = (visible) => { const scene = fgRef.current?.scene?.(); const group = scene?.getObjectByName('layer-planes'); if (group) group.visible = !!visible; };\r\n\r\n  // 초기 로딩: 카메라, 컨트롤, 레이어 평면 설정\r\n  useEffect(() => {\r\n    const fg = fgRef.current; if (!fg) return;\r\n    const controls = fg.controls && fg.controls();\r\n    if (controls) {\r\n      // Disable OrbitControls-driven rotate (we use custom pointer rotation)\r\n      // Keep zoom enabled, but ensure RIGHT mouse button does not trigger dolly/rotate.\r\n      controls.enableRotate = false;\r\n      controls.enablePan = false;\r\n      controls.enableZoom = true;\r\n      // Map mouse buttons explicitly: LEFT rotate (unused here), MIDDLE dolly, RIGHT pan (pan disabled)\r\n      try { controls.mouseButtons = { LEFT: THREE.MOUSE.ROTATE, MIDDLE: THREE.MOUSE.DOLLY, RIGHT: THREE.MOUSE.PAN }; } catch (e) {}\r\n      controls.minPolarAngle = 1e-6;\r\n      controls.maxPolarAngle = 1e-6;\r\n    }\r\n    fg.cameraPosition({ x: 0, y: 1800, z: 0 }, { x: 0, y: 0, z: 0 }, 0);\r\n    const scene = fg.scene(); scene.rotation.order = 'YXZ'; scene.rotation.set(0, 0, 0, 'YXZ');\r\n    addLayerPlanes(); toggleLayerPlanes(true);\r\n  }, []);\r\n\r\n  // 포스(힘) 설정 완화\r\n  useEffect(() => {\r\n    const fg = fgRef.current; if (!fg) return;\r\n    try { fg.d3Force('charge') && fg.d3Force('charge').strength(0); } catch {}\r\n    try { fg.d3Force('link') && fg.d3Force('link').strength(() => 0.05); } catch {}\r\n  }, []);\r\n\r\n  // 데이터 로딩 (3계층 통합: HOSTS + USES+ PHYSICAL 동일레이어 연결)\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      try {\r\n        if (mounted) setLoading(true);\r\n      } catch (e) {}\r\n      try {\r\n        const records = await fetchThreeLayer(PROJECT_FILTER || undefined);\r\n        const g = mergeRecordsToGraph(records);\r\n        if (mounted) setGraphData(g);\r\n      } catch (e) {\r\n        if (mounted) setGraphData(generateMockGraph());\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    })();\r\n    return () => { mounted = false; };\r\n  }, []);\r\n\r\n  // 컨테이너 리사이즈 및 데이터 변경 시 중앙으로 맞춤\r\n  useEffect(() => {\r\n    const recenter = () => { try { fgRef.current && fgRef.current.zoomToFit(600, 40); } catch {} };\r\n    if (graphData.nodes?.length || graphData.links?.length) requestAnimationFrame(recenter);\r\n    const el = containerRef.current;\r\n    let ro;\r\n    if (el && typeof ResizeObserver !== 'undefined') {\r\n      ro = new ResizeObserver(() => requestAnimationFrame(recenter));\r\n      ro.observe(el);\r\n    } else {\r\n      window.addEventListener('resize', recenter);\r\n    }\r\n    return () => {\r\n      if (ro && el) ro.unobserve(el);\r\n      window.removeEventListener('resize', recenter);\r\n    };\r\n  }, [graphData]);\r\n  // ForceGraph3D를 감싸는 컨테이너의 실제 픽셀 크기를 측정하여 width/height로 전달\r\n  useEffect(() => {\r\n    const el = graphContainerRef.current;\r\n    if (!el) return;\r\n    const measure = () => {\r\n      try { setContainerSize({ width: el.clientWidth || 0, height: el.clientHeight || 0 }); } catch {}\r\n    };\r\n    measure();\r\n    let ro;\r\n    if (typeof ResizeObserver !== 'undefined') {\r\n      ro = new ResizeObserver(() => measure());\r\n      try { ro.observe(el); } catch {}\r\n    } else {\r\n      window.addEventListener('resize', measure);\r\n    }\r\n    return () => {\r\n      try { if (ro && el) ro.unobserve(el); } catch {}\r\n      window.removeEventListener('resize', measure);\r\n    };\r\n  }, []);\r\n\r\n  // 회전 제어 (Yaw ±30°, Pitch 제한, Roll 무제한)\r\n  useEffect(() => {\r\n    const fg = fgRef.current; if (!fg) return;\r\n    const dom = fg.renderer().domElement;\r\n    const scene = fg.scene();\r\n    const PITCH_LIMIT = 1.3; const YAW_LIMIT = Math.PI/6; const ROLL_LIMIT = Infinity; const PITCH_SENS = 0.005; const YAW_SENS = 0.006; const ROLL_SENS = 0.006; const KEY_STEP = Math.PI/60;\r\n    const clampAll = () => { scene.rotation.x = THREE.MathUtils.clamp(scene.rotation.x, -PITCH_LIMIT, PITCH_LIMIT); scene.rotation.y = THREE.MathUtils.clamp(scene.rotation.y, -YAW_LIMIT, YAW_LIMIT); scene.rotation.z = THREE.MathUtils.clamp(scene.rotation.z, -ROLL_LIMIT, ROLL_LIMIT); scene.rotation.order='YXZ'; };\r\n  let dragging=false,lastX=0,lastY=0;\r\n  let spacePressed = false;\r\n    const getX = (e) => e.clientX ?? (e.touches && e.touches[0]?.clientX) ?? 0;\r\n    const getY = (e) => e.clientY ?? (e.touches && e.touches[0]?.clientY) ?? 0;\r\n  const onMove = (e)=>{ if(!dragging) return; const x=getX(e), y=getY(e); const dx=x-lastX, dy=y-lastY; lastX=x; lastY=y; if(spacePressed){ scene.rotation.z += dx*ROLL_SENS; } else { scene.rotation.y += dx*YAW_SENS; scene.rotation.x += dy*PITCH_SENS; } clampAll(); };\r\n    const onUp = ()=>{dragging=false;};\r\n    // 우클릭 줌인줌아웃 방지 및 드래그 등 금지\r\n    const onDown = (e)=>{\r\n      try {\r\n        if ((e.pointerType === 'mouse' || typeof e.button === 'number') && e.button === 2) {\r\n          try { e.preventDefault(); e.stopPropagation(); } catch (err) {}\r\n          return;\r\n        }\r\n      } catch (err) {}\r\n      dragging=true; lastX=getX(e); lastY=getY(e);\r\n    };\r\n    dom.addEventListener('pointerdown', onDown, { capture: true });\r\n  const onContextMenu = (ev) => { try { ev.preventDefault(); } catch (e) {} };\r\n  dom.addEventListener('contextmenu', onContextMenu);\r\n    window.addEventListener('pointermove', onMove);\r\n    window.addEventListener('pointerup', onUp);\r\n    dom.addEventListener('pointerleave', onUp);\r\n    const worldDiag = new THREE.Vector3(1,1,1).normalize();\r\n    const onKey = (e)=>{ let used=true; switch(e.key){ case 'ArrowUp': scene.rotation.x -= KEY_STEP; break; case 'ArrowDown': scene.rotation.x += KEY_STEP; break; case 'ArrowLeft': scene.rotation.y -= KEY_STEP; break; case 'ArrowRight': scene.rotation.y += KEY_STEP; break; case 'z': case 'Z': scene.rotation.z -= KEY_STEP; break; case 'x': case 'X': scene.rotation.z += KEY_STEP; break; case 'r': case 'R': scene.rotation.set(0,0,0,'YXZ'); break; case 'u': case 'U': scene.rotateOnWorldAxis(worldDiag, +KEY_STEP); scene.rotation.setFromQuaternion(scene.quaternion,'YXZ'); break; case 'i': case 'I': scene.rotateOnWorldAxis(worldDiag, -KEY_STEP); scene.rotation.setFromQuaternion(scene.quaternion,'YXZ'); break; default: used=false;} if(used){clampAll();} };\r\n    // Space 키를 누르고 드래그하면 Roll(회전) 모드로 전환\r\n    const onSpaceDown = (ev) => { if (ev.code === 'Space' || ev.key === ' ') { spacePressed = true; try { ev.preventDefault(); } catch {} } };\r\n    const onSpaceUp = (ev) => { if (ev.code === 'Space' || ev.key === ' ') { spacePressed = false; try { ev.preventDefault(); } catch {} } };\r\n\r\n    window.addEventListener('keydown', onKey);\r\n    window.addEventListener('keydown', onSpaceDown);\r\n    window.addEventListener('keyup', onSpaceUp);\r\n    return ()=>{ dom.removeEventListener('pointerdown', onDown); dom.removeEventListener('contextmenu', onContextMenu); window.removeEventListener('pointermove', onMove); window.removeEventListener('pointerup', onUp); dom.removeEventListener('pointerleave', onUp); window.removeEventListener('keydown', onKey); window.removeEventListener('keydown', onSpaceDown); window.removeEventListener('keyup', onSpaceUp); };\r\n  }, []);\r\n\r\n  // 필터링 후 시각화용 그래프 계산\r\n  const visible = useMemo(() => {\r\n    const passesNode = (n) => {\r\n      if (!layerFilter[n.layer]) return false;\r\n      if (search) {\r\n        const q = search.toLowerCase();\r\n        const hay = [n.label,n.ip,n.user_name,n.role,n.dept,n.hostname,n.service_name,n.subnet,n.type]\r\n          .filter(Boolean).join(' ').toLowerCase();\r\n        if (!hay.includes(q)) return false;\r\n      }\r\n      return true;\r\n    };\r\n    const nodeSet = new Set(graphData.nodes.filter(passesNode).map(n => n.id));\r\n    const passesLink = (l) => {\r\n      const s = l.__sid || (typeof l.source==='object'?l.source.id:l.source);\r\n      const t = l.__tid || (typeof l.target==='object'?l.target.id:l.target);\r\n      if (!nodeSet.has(s) || !nodeSet.has(t)) return false;\r\n      if (assumedFilter !== 'all' && (!!l.assumed !== (assumedFilter==='true'))) return false;\r\n      const sn = byId[s]; const tn = byId[t];\r\n      if (sn && tn) { if (!statusFilter.has(sn.status) || !statusFilter.has(tn.status)) return false; }\r\n      return true;\r\n    };\r\n    const links = graphData.links.filter(passesLink);\r\n    const used = new Set(); links.forEach(l => { const s = l.__sid || (typeof l.source==='object'?l.source.id:l.source); const t = l.__tid || (typeof l.target==='object'?l.target.id:l.target); used.add(s); used.add(t); });\r\n    const nodes = graphData.nodes.filter(n => nodeSet.has(n.id) && (used.has(n.id) || !search));\r\n    return { nodes, links };\r\n  }, [graphData, layerFilter, assumedFilter, statusFilter, search, byId]);\r\n\r\n  const highlight = useMemo(() => {\r\n    if (!selectedId) return { nodes: new Set(), links: new Set() };\r\n    const nSet = new Set([selectedId]); const lSet = new Set();\r\n    (adj.get(selectedId) || []).forEach(nid => nSet.add(nid));\r\n    visible.links.forEach(l => { const s = l.__sid || (typeof l.source==='object'?l.source.id:l.source); const t = l.__tid || (typeof l.target==='object'?l.target.id:l.target); if (nSet.has(s) && nSet.has(t)) lSet.add(l); });\r\n    return { nodes: nSet, links: lSet };\r\n  }, [selectedId, visible, adj]);\r\n\r\n  const isNodeDimmed = (n) => selectedId && !highlight.nodes.has(n.id);\r\n  const isLinkDimmed = (l) => selectedId && !highlight.links.has(l);\r\n  const nodeColor = (n) => (!selectedId ? (LAYER_COLORS[n.layer] || '#B0B0B0') : (isNodeDimmed(n) ? '#2A2A2A' : (LAYER_COLORS[n.layer] || '#B0B0B0')));\r\n  const linkColor = (l) => { const rgb = new THREE.Color(KIND_COLORS[l.kind] || '#A0AEC0'); const c = isLinkDimmed(l) ? rgb.lerp(new THREE.Color('#2A2A2A'), 0.6) : rgb; return `#${c.getHexString()}`; };\r\n  const linkWidth = (l) => isLinkDimmed(l) ? 0.3 : (l.assumed ? 0.6 : 1.5);\r\n  const linkParticles = (l) => { if (!pulse || !selectedId) return 0; const s = l.source; const t = l.target; if (!s || !t || typeof s.id === 'undefined' || typeof t.id === 'undefined') return 0; const touchesSel = s.id === selectedId || t.id === selectedId; return touchesSel && isCrossLayer(s, t) ? 2 : 0; };\r\n  const linkMaterial = (l) => { const color = new THREE.Color(linkColor(l)); if (l.assumed) { try { return new THREE.LineDashedMaterial({ color, dashSize: 2, gapSize: 1, transparent: true, opacity: isLinkDimmed(l) ? 0.25 : 0.65 }); } catch { return new THREE.LineBasicMaterial({ color, transparent: true, opacity: isLinkDimmed(l) ? 0.25 : 0.65 }); } } return new THREE.LineBasicMaterial({ color, transparent: true, opacity: isLinkDimmed(l) ? 0.25 : 0.95 }); };\r\n\r\n  const onBackgroundClick = () => { setSelectedId(null); onNodeSelect(null); onInspectorChange(null); setEventLogs([]); };\r\n  const resetView = () => { setSelectedId(null); onNodeSelect(null); const fg = fgRef.current; if (!fg) return; try { const rot = fg.scene().rotation; rot.order='YXZ'; rot.x = 0; rot.y = 0; rot.z = 0; } catch {} fg.cameraPosition({ x: 0, y: 1800, z: 0 }, { x: 0, y: 0, z: 0 }, 600); };\r\n  const onNodeClick = (node) => {\r\n    setSelectedId(node?.id || null);\r\n    if (node) {\r\n      const panel = <NodeDetailPanel selected={node} adj={adj} visible={visible} byId={byId} onClearSelection={onBackgroundClick} onResetView={resetView} />;\r\n      onNodeSelect(panel);\r\n      try { onInspectorChange(panel); } catch(e) {}\r\n      \r\n      // 연결된 노드 정보 수집\r\n      const connectedNodes = adj.get(node.id) || new Set();\r\n      const connectedIps = Array.from(connectedNodes)\r\n        .map(nid => byId[nid])\r\n        .filter(n => n && n.ip)\r\n        .map(n => n.ip);\r\n      \r\n      // 클릭한 노드와 연결된 모든 링크의 상세 정보 수집 (dbInfo)\r\n      const dbInfo = visible.links\r\n        .filter(link => {\r\n          const sid = link.__sid || (typeof link.source === 'object' ? link.source.id : link.source);\r\n          const tid = link.__tid || (typeof link.target === 'object' ? link.target.id : link.target);\r\n          return sid === node.id || tid === node.id;\r\n        })\r\n        .map(link => {\r\n          const sid = link.__sid || (typeof link.source === 'object' ? link.source.id : link.source);\r\n          const tid = link.__tid || (typeof link.target === 'object' ? link.target.id : link.target);\r\n          const srcNode = byId[sid];\r\n          const dstNode = byId[tid];\r\n          \r\n          return {\r\n            src_IP: srcNode ? {\r\n              id: srcNode.id,\r\n              ip: srcNode.ip,\r\n              name: srcNode.label || srcNode.hostname || srcNode.name || srcNode.user_name || srcNode.service_name || srcNode.id,\r\n              type: srcNode.type,\r\n              subnet: srcNode.subnet,\r\n              dns: srcNode.dns,\r\n              gateway: srcNode.gateway,\r\n              description: srcNode.description || srcNode.service_name,\r\n              cve: extractCVE(srcNode),\r\n              value: srcNode.value,\r\n              key: srcNode.key,\r\n              __labels: [srcNode.layer, srcNode.type],\r\n              __id: srcNode.id,\r\n              index: srcNode.index\r\n            } : null,\r\n            dst_IP: dstNode ? {\r\n              id: dstNode.id,\r\n              ip: dstNode.ip,\r\n              name: dstNode.label || dstNode.hostname || dstNode.name || dstNode.user_name || dstNode.service_name || dstNode.id,\r\n              description: dstNode.description || dstNode.service_name,\r\n              cve: extractCVE(dstNode),\r\n              value: dstNode.value,\r\n              key: dstNode.key,\r\n              __labels: [dstNode.layer, dstNode.type],\r\n              __id: dstNode.id,\r\n              index: dstNode.index\r\n            } : null,\r\n            edge: {\r\n              sourceIP: sid,\r\n              targetIP: tid,\r\n              kind: link.kind,\r\n              rel: link.kind,\r\n              assumed: link.assumed,\r\n              confidence: link.confidence\r\n            }\r\n          };\r\n        });\r\n      \r\n      const newLog = {\r\n        message: `노드 선택: ${node.label || node.id}`,\r\n        nodeInfo: { layer: node.layer, type: node.type, ip: node.ip },\r\n        connectedCount: connectedNodes.size,\r\n        connectedIps: connectedIps,\r\n        dbInfo: dbInfo\r\n      };\r\n      setEventLogs([newLog]);\r\n    } else { onNodeSelect(null); onInspectorChange(null); setEventLogs([]); }\r\n  };\r\n  const onLinkClick = (l) => { const sid = l.__sid || (typeof l.source==='object'?l.source.id:l.source); const node = byId[sid]; if (node) onNodeClick(node); };\r\n  const onLinkUpdate = (link, threeObj) => { try { const line = link.__lineObj || threeObj; if (line && line.computeLineDistances) line.computeLineDistances(); } catch {} };\r\n\r\n  // 렌더용 그래프: 펄스 OFF일 경우 1-홉 이내만 표시\r\n  const graphToRender = useMemo(() => {\r\n    if (pulse) return visible;\r\n    if (!selectedId) return { nodes: visible.nodes, links: [] };\r\n    const sel = new Set([selectedId]); (adj.get(selectedId) || []).forEach(nid => sel.add(nid));\r\n    const links = visible.links.filter(l => { const s = l.__sid || (typeof l.source==='object'? l.source.id : l.source); const t = l.__tid || (typeof l.target==='object'? l.target.id : l.target); return sel.has(s) || sel.has(t); });\r\n    return { nodes: visible.nodes, links };\r\n  }, [pulse, visible, selectedId, adj]);\r\n\r\n  return (\r\n    <Card ref={containerRef} sx={{\r\n      width: '100%',\r\n      height: 'calc(100vh - 120px)',\r\n      bgcolor: 'background.paper',\r\n      borderRadius: 2,\r\n      boxShadow: 3,\r\n      overflow: 'hidden'\r\n    }}>\r\n      <CardContent sx={{ p: 2, height: '100%', display: 'flex', gap: 2 }}>\r\n        {/* 메인 컨텐츠 영역 */}\r\n        <div style={{ flex: 1, minWidth: 0, height: '100%' }}>\r\n          <div style={{ width: '100%', height: '100%', minHeight: 600, color: '#fff', display: 'flex', flexDirection: 'row' }}>\r\n            <Card sx={{\r\n              flex: 1,\r\n              position: 'relative',\r\n              overflow: 'hidden',\r\n              borderRadius: '20px',\r\n              boxShadow: '0 2px 8px rgba(57, 48, 107, 0.07)',\r\n              background: '#0b1220',\r\n              mr: 1\r\n            }}>\r\n              <div ref={graphContainerRef} style={{\r\n                width: '100%',\r\n                height: '100%',\r\n                position: 'relative'\r\n              }}>\r\n                {/* /ExtInt/TimeSeriesVisualization 이동 버튼 */}\r\n                <IconButton\r\n                  size=\"small\"\r\n                  aria-label=\"시계열 기반 이상 탐지로 이동\"\r\n                  title=\"시계열 기반 이상 탐지로 이동\"\r\n                  onClick={() => window.location.href = '/ExtInt/TimeSeriesVisualization'}\r\n                  sx={{\r\n                    position: 'absolute',\r\n                    top: 16,\r\n                    right: 16,\r\n                    zIndex: 1000,\r\n                    bgcolor: 'rgba(124,58,237,0.8)',\r\n                    color: '#fff',\r\n                    borderRadius: '50%',\r\n                    width: 32,\r\n                    height: 32,\r\n                    boxShadow: '0 2px 8px rgba(124,58,237,0.3)',\r\n                    '&:hover': {\r\n                      bgcolor: '#9333ea',\r\n                      color: '#fff',\r\n                    },\r\n                  }}\r\n                >\r\n                  <ClusterOutlined style={{ fontSize: 18 }} />\r\n                </IconButton>\r\n            {/* 툴바 */}\r\n            <div style={{ position: 'absolute', top: 12, left: 12, zIndex: 10, background: 'rgba(57,48,107,0.7)', backdropFilter: 'blur(4px)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: 12, padding: 12 }}>\r\n          <div style={{ display: 'flex', flexWrap: 'wrap', gap: 12, alignItems: 'center', fontSize: 12 }}>\r\n            <input placeholder=\"검색: label, ip, user, role, dept...\" value={search} onChange={(e)=>setSearch(e.target.value)} style={{ padding: '4px 8px', borderRadius: 6, border: '1px solid rgba(128,128,128,0.5)', background: 'rgba(20,20,20,0.7)', color: '#fff' }} />\r\n            <span style={{ width: 1, height: 24, background: 'rgba(255,255,255,0.1)' }} />\r\n            {['physical','logical','persona'].map(id => (\r\n              <label key={id} style={{ display: 'flex', gap: 6, alignItems: 'center' }}>\r\n                <input type=\"checkbox\" checked={layerFilter[id]} onChange={(e)=>setLayerFilter(v=>({...v,[id]:e.target.checked}))} />\r\n                  <span style={{ display: 'inline-flex', gap: 6, alignItems: 'center' }}>\r\n                    <span style={{ width: 10, height: 10, borderRadius: 2, background: LAYER_COLORS[id] }} />\r\n                    <span style={{ color: LAYER_COLORS[id], fontWeight: 700 }}>{id}</span>\r\n                  </span>\r\n              </label>\r\n            ))}\r\n            <span style={{ width: 1, height: 24, background: 'rgba(255,255,255,0.1)' }} />\r\n              <label style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n                <span style={{ color: '#fbbf24', fontWeight: 700 }}>assumed</span>\r\n                <select value={assumedFilter} onChange={(e)=>setAssumedFilter(e.target.value)} style={{ background: 'rgba(20,20,20,0.7)', color:'#fbbf24', border:'1px solid rgba(128,128,128,0.5)', borderRadius: 6, padding: '2px 4px', fontWeight: 700 }}>\r\n                  <option value=\"all\" style={{ color: '#fbbf24' }}>all</option>\r\n                  <option value=\"true\" style={{ color: '#fbbf24' }}>true</option>\r\n                  <option value=\"false\" style={{ color: '#fbbf24' }}>false</option>\r\n                </select>\r\n              </label>\r\n            <span style={{ width: 1, height: 24, background: 'rgba(255,255,255,0.1)' }} />\r\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                <span style={{ color: '#38bdf8', fontWeight: 700 }}>status</span>\r\n                {STATUS.map(s => {\r\n                  let color = '#e5e7eb';\r\n                  if (s === 'UP') color = '#22c55e';\r\n                  else if (s === 'DOWN') color = '#ef4444';\r\n                  else if (s === 'UNKNOWN') color = '#fbbf24';\r\n                  return (\r\n                    <label key={s} style={{ display:'flex', alignItems:'center', gap:6 }}>\r\n                      <input type=\"checkbox\" checked={statusFilter.has(s)} onChange={(e)=>{const nxt=new Set(statusFilter); e.target.checked?nxt.add(s):nxt.delete(s); setStatusFilter(nxt);}} />\r\n                      <span style={{ textTransform: 'uppercase', color, fontWeight: 700 }}>{s}</span>\r\n                    </label>\r\n                  );\r\n                })}\r\n              </div>\r\n            <span style={{ width: 1, height: 24, background: 'rgba(255,255,255,0.1)' }} />\r\n            <button onClick={()=>setPulse(p=>!p)} style={{ padding:'4px 8px', borderRadius:6, background: pulse ? '#3b82f6' : '#F0EDFD', color:'#000', border:'1px solid rgba(128,128,128,0.5)' }}>{pulse ? '펄스 ON' : '펄스 OFF'}</button>\r\n            <button onClick={() => { setSearch(''); setLayerFilter({ physical: true, logical: true, persona: true }); setAssumedFilter('all'); setStatusFilter(new Set(STATUS)); }} style={{ padding:'4px 8px', borderRadius:6, background:'#F0EDFD', color:'#000', border:'1px solid rgba(128,128,128,0.5)' }}>필터 초기화</button>\r\n            <button onClick={resetView} style={{ padding:'4px 8px', borderRadius:6, background:'#F0EDFD', color:'#000', border:'1px solid rgba(128,128,128,0.5)' }}>뷰 초기화</button>\r\n          </div>\r\n        </div>\r\n\r\n        <ForceGraph3D\r\n          ref={fgRef}\r\n          graphData={graphToRender}\r\n          backgroundColor=\"#0b1220\" // 3계층 시각화 배경색 부분 \r\n          width={containerSize.width}\r\n          height={containerSize.height}\r\n          nodeAutoColorBy={null}\r\n          nodeColor={nodeColor}\r\n          nodeLabel={(n) => `${n.label} (layer: ${n.layer})`}\r\n          nodeRelSize={5.2}\r\n          linkColor={linkColor}\r\n          linkWidth={linkWidth}\r\n          linkMaterial={linkMaterial}\r\n          linkDirectionalParticles={linkParticles}\r\n          linkDirectionalParticleWidth={() => 2}\r\n          linkDirectionalParticleSpeed={() => 0.006 + Math.random()*0.004}\r\n          onNodeClick={onNodeClick}\r\n          onBackgroundClick={onBackgroundClick}\r\n          onLinkClick={onLinkClick}\r\n          onLinkUpdate={onLinkUpdate}\r\n          cooldownTicks={0}\r\n          enableNodeDrag={false}\r\n          showNavInfo={false}\r\n        />\r\n        {loading && (\r\n          <div style={{position:'absolute',left:0,top:0,right:0,bottom:0,display:'flex',alignItems:'center',justifyContent:'center',pointerEvents:'none'}}>\r\n            <div style={{background:'rgba(0,0,0,0.6)',color:'#fff',padding:'12px 18px',borderRadius:8,backdropFilter:'blur(4px)'}}>Loading…</div>\r\n          </div>\r\n        )}\r\n              </div>\r\n            </Card>\r\n          </div>\r\n        </div>\r\n\r\n        {/* 우측 이벤트 로그 패널 */}\r\n        <ThreelayerLog eventLogs={eventLogs} />\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n"],"names":["InternalLog","memo","eventLogs","jsx","Card","elevation","sx","minWidth","width","bgcolor","color","border","borderRadius","display","flexDirection","flexShrink","height","children","jsxs","CardContent","p","gap","flex","minHeight","Typography","variant","fontWeight","mb","style","overflowY","length","fontSize","padding","map","log","idx","marginBottom","background","message","nodeInfo","marginTop","layer","type","connectedCount","Array","isArray","connectedIps","cursor","margin","paddingLeft","ip","i","dbInfo","info","mt","py","px","srcLabel","String","src_IP","__labels","toLowerCase","srcIsLogical","Fragment","name","subnet","dns","gateway","filter","v","k","dst_IP","description","cve","edge","rel","kind","sourceIP","targetIP","join","key","value","id","displayName","STATUS","LAYER_COLORS","physical","logical","persona","LAYOUT","KIND_COLORS","CONNECTS_TO","CONNECTED","HOSTS","USES","IN_SUBNET","IN_VLAN","MEMBER_OF","API_BASE","process","define_process_env_default","REACT_APP_API_BASE","extractCVE","node","out","Set","cveRegex","addVals","vals","forEach","x","raw","obj","CVE","s","trim","matches","match","m","add","toUpperCase","includes","cves","CVEs","cve_list","vulns","vulnerabilities","vulnerability","tags","from","normalizeNode","labelsLower","toString","label","hostname","user_name","service_name","vlan","status","severity","os","proto","port","role","dept","device_ids","Math","random","y","z","normalizeEdge","rawEdge","source","target","assumed","Boolean","confidence","__sid","__tid","NodeDetailPanel","selected","adj","visible","byId","onClearSelection","onResetView","borderBottom","rowGap","wordBreak","ConnLists","selectedId","borderTop","onClick","overflow","ConnList","listType","items","get","nid","l","links","find","lnk","t","other","cross","push","it","alignItems","justifyContent","CyberMultiLayer3D","onNodeSelect","onInspectorChange","fgRef","useRef","containerRef","graphContainerRef","containerSize","setContainerSize","useState","graphData","setGraphData","nodes","pulse","setPulse","setSelectedId","loading","setLoading","search","setSearch","layerFilter","setLayerFilter","assumedFilter","setAssumedFilter","statusFilter","setStatusFilter","setEventLogs","useMemo","Object","fromEntries","n","Map","set","has","__s","__t","buildAdjacency","useEffect","fg","current","controls","enableRotate","enablePan","enableZoom","mouseButtons","LEFT","THREE.MOUSE","ROTATE","MIDDLE","DOLLY","RIGHT","PAN","e","minPolarAngle","maxPolarAngle","cameraPosition","scene","rotation","order","existing","getObjectByName","remove","group","THREE.Group","makePlane","planeGeo","THREE.PlaneGeometry","mat","THREE.MeshBasicMaterial","transparent","opacity","depthWrite","mesh","THREE.Mesh","position","edges","THREE.EdgesGeometry","line","THREE.LineSegments","THREE.LineBasicMaterial","canvas","document","createElement","ctx","getContext","fillStyle","fillRect","font","textAlign","textBaseline","fillText","tex","THREE.CanvasTexture","sprMat","THREE.SpriteMaterial","sprite","THREE.Sprite","scale","addLayerPlanes","toggleLayerPlanes","d3Force","strength","mounted","g","allRecords","nodesMap","rec","sRaw","tRaw","eRaw","r","sid","tid","values","subs","devs","subnetCenters","angle","max","PI","cx","cos","cy","sin","d","c","mergeRecordsToGraph","async","url","encodeURIComponent","res","fetch","ok","Error","json","fetchThreeLayer","floor","generateMockGraph","recenter","zoomToFit","el","ro","ResizeObserver","requestAnimationFrame","observe","window","addEventListener","unobserve","removeEventListener","measure","clientWidth","clientHeight","dom","renderer","domElement","YAW_LIMIT","ROLL_LIMIT","Infinity","KEY_STEP","clampAll","THREE.MathUtils","clamp","dragging","lastX","lastY","spacePressed","getX","clientX","touches","getY","clientY","onMove","dx","dy","onUp","onDown","pointerType","button","preventDefault","stopPropagation","err","capture","onContextMenu","ev","worldDiag","THREE.Vector3","normalize","onKey","used","rotateOnWorldAxis","setFromQuaternion","quaternion","onSpaceDown","code","onSpaceUp","nodeSet","q","sn","tn","highlight","nSet","lSet","isLinkDimmed","linkColor","rgb","THREE.Color","lerp","getHexString","onBackgroundClick","resetView","rot","onNodeClick","panel","connectedNodes","link","srcNode","dstNode","__id","index","newLog","size","graphToRender","sel","ref","boxShadow","mr","IconButton","title","location","href","top","right","zIndex","ClusterOutlined","left","backdropFilter","flexWrap","placeholder","onChange","checked","nxt","delete","textTransform","ForceGraph3D","backgroundColor","nodeAutoColorBy","nodeColor","isNodeDimmed","nodeLabel","nodeRelSize","linkWidth","linkMaterial","THREE.LineDashedMaterial","dashSize","gapSize","linkDirectionalParticles","b","linkDirectionalParticleWidth","linkDirectionalParticleSpeed","onLinkClick","onLinkUpdate","threeObj","__lineObj","computeLineDistances","cooldownTicks","enableNodeDrag","showNavInfo","bottom","pointerEvents","ThreelayerLog"],"mappings":"iYAGA,MAAMA,EAAcC,EAAAA,KAAK,EAAGC,YAAY,MAElCC,EAAAA,IAACC,EAAA,CAAKC,UAAW,EAAGC,GAAI,CACtBC,SAAU,IACVC,MAAO,IACPC,QAAS,UACTC,MAAO,OACPC,OAAQ,oBAERC,aAAc,OACdC,QAAS,OACTC,cAAe,SACfC,WAAY,EACZC,OAAQ,QAERC,SAAAC,EAAAA,KAACC,EAAA,CAAYb,GAAI,CAAEc,EAAG,EAAGP,QAAS,OAAQC,cAAe,SAAUO,IAAK,EAAGC,KAAM,EAAGC,UAAW,GAC7FN,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEoB,WAAY,IAAKhB,MAAO,UAAWiB,GAAI,GAAKV,SAAA,WAClFd,EAAAA,IAAC,MAAA,CAAIyB,MAAO,CAAEN,KAAM,EAAGO,UAAW,OAAQN,UAAW,GACpDN,SAAqB,IAArBf,EAAU4B,aACR,MAAA,CAAIF,MAAO,CAAElB,MAAO,OAAQqB,SAAU,OAAQC,QAAS,QAAUf,SAAA,4BAIlEf,EAAU+B,IAAI,CAACC,EAAKC,IAClBjB,OAAC,OAAcU,MAAO,CACpBI,QAAS,OACTI,aAAc,MACdC,WAAY,yBACZzB,aAAc,MACdmB,SAAU,OACVrB,MAAO,QAENO,SAAA,CAAAiB,EAAII,SAAWnC,EAAAA,IAAC,MAAA,CAAIyB,MAAO,CAAEF,WAAY,IAAKU,aAAc,MAAO1B,MAAO,QAAWO,WAAIqB,UACzFJ,EAAIK,UACHrB,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEG,SAAU,OAAQrB,MAAO,OAAQ8B,UAAW,OAASvB,SAAA,CAAA,UACzDiB,EAAIK,SAASE,MAAM,YAAUP,EAAIK,SAASG,aAK9B,IAAvBR,EAAIS,gBACHzB,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEY,UAAW,MAAOJ,aAAc,MAAO1B,MAAO,QAAUO,SAAA,CAAA,cACxDiB,EAAIS,eACfC,MAAMC,QAAQX,EAAIY,eAAiBZ,EAAIY,aAAahB,OAAS,GAC5DZ,EAAAA,KAAC,WAAQU,MAAO,CAAEY,UAAW,MAAO9B,MAAO,QACzCO,SAAA,CAAAd,EAAAA,IAAC,UAAA,CAAQyB,MAAO,CAAEmB,OAAQ,UAAWrC,MAAO,UAAWgB,WAAY,QAAUT,SAAA,oBAC7Ed,EAAAA,IAAC,KAAA,CAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAAiB,EAAIY,aAAab,IAAI,CAACiB,EAAIC,IACzBhD,EAAAA,IAAC,KAAA,CAAgByB,MAAO,CAAElB,MAAO,QAAWO,SAAAiC,GAAnCA,EAAKC,YASzBP,MAAMC,QAAQX,EAAIkB,SAAWlB,EAAIkB,OAAOtB,OAAS,GAAKI,EAAIkB,OAAOnB,IAAI,CAACoB,EAAMF,UAC1E/C,EAAA,CAAaC,UAAW,EAAGC,GAAI,CAC9BG,QAAS,wBACTE,OAAQ,kCACRC,aAAc,EACd0C,GAAI,GAEJrC,SAAAd,EAAAA,IAACgB,EAAA,CAAYb,GAAI,CAAEiD,GAAI,KAAMC,GAAI,KAC7BvC,SAAA,MACA,MAAMwC,EAAWC,OAAOL,GAAMM,QAAQC,WAAW,IAAM,IAAIC,cAErDC,EAA4B,YAAbL,EACrB,MAFmC,aAAbA,EAIlBvC,EAAAA,KAAA6C,WAAA,CAEG9C,SAAA,CAAAoC,EAAKM,QACJzC,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEQ,aAAc,QAC1BnB,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,aACpFd,MAAC,MAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAA,CACC,CAAC,OAAQoC,EAAKM,OAAOK,MACrB,CAAC,OAAQX,EAAKM,OAAOjB,MACrB,CAAC,KAAMW,EAAKM,OAAOT,IACnB,CAAC,SAAUG,EAAKM,OAAOM,QACvB,CAAC,MAAOZ,EAAKM,OAAOO,KACpB,CAAC,UAAWb,EAAKM,OAAOQ,UACxBC,OAAO,GAAIC,KAAOA,SAAuC,KAANA,GAAUpC,IAAI,EAAEqC,EAAGD,KACtEnD,EAAAA,KAAC,KAAA,CAAWU,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEZ,OAAOW,KAAjFC,SAOhBjB,EAAKkB,QACJrD,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEQ,aAAc,QAC1BnB,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,aACpFd,MAAC,MAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAA,CACC,CAAC,OAAQoC,EAAKkB,OAAOP,MACrB,CAAC,cAAeX,EAAKkB,OAAOC,aAC5B,CAAC,MAAOnB,EAAKkB,OAAOE,MACpBL,OAAO,GAAIC,KAAOA,SAAuC,KAANA,GAAUpC,IAAI,EAAEqC,EAAGD,KACtEnD,EAAAA,KAAC,KAAA,CAAWU,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEZ,OAAOW,KAAjFC,SAOhBjB,EAAKqB,MACJxD,EAAAA,KAAC,MAAA,CACCD,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,cACpFd,MAAC,MAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAA,CACC,CAAC,MAAOoC,EAAKqB,KAAKC,KAAOtB,EAAKqB,KAAKE,MACnC,CAAC,QAASvB,EAAKqB,KAAKG,UACpB,CAAC,WAAYxB,EAAKqB,KAAKI,WACvB7C,IAAI,EAAEqC,EAAGD,MACT,MAAMxD,EAAU+B,MAAMC,QAAQwB,GAAKA,EAAEU,KAAK,MAAQrB,OAAOW,GACzD,cACG,KAAA,CAAWzC,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEzD,IAA1EyD,aAWrBR,EAEA5C,EAAAA,KAAA6C,WAAA,CAEG9C,SAAA,CAAAoC,EAAKM,QACJzC,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEQ,aAAc,QAC1BnB,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,aACpFd,MAAC,MAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAA,CACC,CAAC,OAAQoC,EAAKM,OAAOK,MACrB,CAAC,cAAeX,EAAKM,OAAOa,aAC5B,CAAC,MAAOnB,EAAKM,OAAOc,MACpBL,OAAO,EAAC,CAAGC,KAAOA,SAAuC,KAANA,GAAUpC,IAAI,EAAEqC,EAAGD,MACtE,MAAMxD,EAAU+B,MAAMC,QAAQwB,GAAKA,EAAEU,KAAK,MAAQrB,OAAOW,GACzD,cACG,KAAA,CAAWzC,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEzD,IAA1EyD,UAQlBjB,EAAKkB,QACJrD,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEQ,aAAc,QAC1BnB,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,aACpFd,EAAAA,IAAC,MAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IACjChC,eACiC,IAApBoC,EAAKkB,OAAOS,UAA2C,IAAtB3B,EAAKkB,OAAOU,MAEtD,CACE,CAAC,KAAM5B,EAAKkB,OAAOW,IACnB,CAAC,MAAO7B,EAAKkB,OAAOS,KACpB,CAAC,QAAS3B,EAAKkB,OAAOU,QAExB,CACE,CAAC,OAAQ5B,EAAKkB,OAAOP,MACrB,CAAC,cAAeX,EAAKkB,OAAOC,aAC5B,CAAC,MAAOnB,EAAKkB,OAAOE,OAGvBL,OAAO,EAAC,CAAGC,KAAOA,SAAuC,KAANA,GACnDpC,IAAI,EAAEqC,EAAGD,MACR,MAAMxD,EAAU+B,MAAMC,QAAQwB,GAAKA,EAAEU,KAAK,MAAQrB,OAAOW,GACzD,cACG,KAAA,CAAWzC,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEzD,IAA1EyD,UAStBjB,EAAKqB,MACJxD,EAAAA,KAAC,MAAA,CACCD,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,cACpFd,MAAC,MAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAA,CACC,CAAC,MAAOoC,EAAKqB,KAAKC,KAAOtB,EAAKqB,KAAKE,MACnC,CAAC,QAASvB,EAAKqB,KAAKG,UACpB,CAAC,WAAYxB,EAAKqB,KAAKI,WACvB7C,IAAI,EAAEqC,EAAGD,MACT,MAAMxD,EAAU+B,MAAMC,QAAQwB,GAAKA,EAAEU,KAAK,MAAQrB,OAAOW,GACzD,cACG,KAAA,CAAWzC,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEzD,IAA1EyD,aAYvBpD,EAAAA,KAAA6C,WAAA,CACG9C,SAAA,CAAAoC,EAAKM,QACJzC,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEQ,aAAc,QAC1BnB,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,aACpFd,EAAAA,IAAC,KAAA,CAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAA,CAAC,CAAC,KAAMoC,EAAKM,OAAOuB,KAAKjD,IAAI,EAAEqC,EAAGD,KACjCnD,EAAAA,KAAC,KAAA,CAAWU,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEZ,OAAOW,KAAjFC,SAKhBjB,EAAKkB,QACJrD,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEQ,aAAc,QAC1BnB,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,aACpFd,MAAC,MAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAA,CAAC,CAAC,KAAMoC,EAAKkB,OAAOW,KAAKjD,IAAI,EAAEqC,EAAGD,MACjC,MAAMxD,EAAU+B,MAAMC,QAAQwB,GAAKA,EAAEU,KAAK,MAAQrB,OAAOW,GACzD,cACG,KAAA,CAAWzC,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEzD,IAA1EyD,UAMlBjB,EAAKqB,MACJxD,EAAAA,KAAC,MAAA,CACCD,SAAA,CAAAd,EAAAA,IAACqB,EAAA,CAAWC,QAAQ,YAAYnB,GAAI,CAAEI,MAAO,UAAWgB,WAAY,IAAKC,GAAI,IAAOV,SAAA,cACpFd,MAAC,MAAGyB,MAAO,CAAEoB,OAAQ,EAAGC,YAAa,IAClChC,SAAA,CACC,CAAC,MAAOoC,EAAKqB,KAAKC,KAAOtB,EAAKqB,KAAKE,MACnC,CAAC,QAASvB,EAAKqB,KAAKG,UACpB,CAAC,WAAYxB,EAAKqB,KAAKI,WACvB7C,IAAI,EAAEqC,EAAGD,MACT,MAAMxD,EAAU+B,MAAMC,QAAQwB,GAAKA,EAAEU,KAAK,MAAQrB,OAAOW,GACzD,cACG,KAAA,CAAWzC,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAAC,EAAAA,KAAC,IAAA,CAAEU,MAAO,CAAElB,MAAO,WAAcO,SAAA,CAAAqD,EAAE,OAAK,IAAEzD,IAA1EyD,YAQzB,EAzLE,MAPKnB,MAlCLhB,YA+OxBnC,EAAYmF,YAAc,uBCjQ1B,MAAMC,EAAS,CAAC,KAAM,OAAQ,WACxBC,EAAe,CAAEC,SAAU,UAAWC,QAAS,UAAWC,QAAS,WACnEC,EACQ,IADRA,GAEgB,IAFhBA,EAE+B,EAF/BA,EAE2C,IAF3CA,EAGY,IAHZA,EAG0B,KAG1BC,EAAc,CAClBC,YAAa,UACbC,UAAW,UACXC,MAAO,UACPC,KAAM,UACNC,UAAW,UACXC,QAAS,UACTC,UAAW,WAIPC,EAA+B,oBAAZC,SAA2BC,GAAeA,EAAYC,oBAAuB,wBAOtG,SAASC,EAAWC,GAClB,IAAKA,EAAM,MAAO,GAClB,MACMC,MAAUC,IAOVC,EAAW,kBACXC,EAAWC,IATD,IAACvC,KAUPuC,EAVmB,MAALvC,EAAY,GAAKzB,MAAMC,QAAQwB,GAAKA,EAAI,CAACA,IAUjDwC,QAASC,IACrB,MAAMC,EAAmB,iBAAND,EAAiBA,GAThBE,EASmCF,IAR9B,iBAARE,IAEjBA,EAAIvC,KAAOuC,EAAIC,KAAOD,EAAI9B,IAAM8B,EAAI/B,OAAS+B,EAAIhD,MAAQgD,EAAIhC,KAAOgC,EAAIxC,cAF9B,GADvB,IAACwC,EAUpB,MAAME,EAAIxD,OAAOqD,GAAO,IAAII,OAC5B,IAAKD,EAAG,OACR,MAAME,EAAUF,EAAEG,MAAMX,GACpBU,EAASA,EAAQP,QAASS,GAAMd,EAAIe,IAAID,EAAEE,gBACrCN,EAAEM,cAAcC,SAAS,QAAQjB,EAAIe,IAAIL,EAAEM,kBAaxD,OAVAb,EAAQJ,EAAK9B,KACbkC,EAAQJ,EAAKU,KACbN,EAAQJ,EAAKmB,MACbf,EAAQJ,EAAKoB,MACbhB,EAAQJ,EAAKqB,UACbjB,EAAQJ,EAAKsB,OACblB,EAAQJ,EAAKuB,iBACbnB,EAAQJ,EAAKwB,eACbpB,EAAQJ,EAAKyB,MACbrB,EAAQJ,EAAK/B,aACN5B,MAAMqF,KAAKzB,EACpB,CAGA,SAAS0B,EAAcnB,GAErB,MAAMoB,GAAepB,EAAInD,UAAY,IAAI3B,IAAIiF,GAAKxD,OAAOwD,GAAGrD,eAC5D,IAAIpB,EACDsE,EAAItE,OAASiB,OAAOqD,EAAItE,OAAOoB,gBAC/BsE,EAAYV,SAAS,WAAa,UAC9BU,EAAYV,SAAS,YAAcU,EAAYV,SAAS,YAAcU,EAAYV,SAAS,WAAaU,EAAYV,SAAS,QAAW,WACxIU,EAAYV,SAAS,aAAeU,EAAYV,SAAS,WAAaU,EAAYV,SAAS,QAAW,aAIzG/E,GAAQqE,EAAIrE,MAAQyF,EAAY,IAAM,UAAUC,WAAWvE,cAC3DwE,EAAQtB,EAAIsB,OAAStB,EAAIuB,UAAYvB,EAAI/C,MAAQ+C,EAAIwB,WAAaxB,EAAIyB,cAAgBzB,EAAI9C,QAAU8C,EAAI7D,IAAM6D,EAAI7B,GAGpH,OAFGmD,QAAsB,IAAbtB,EAAI0B,OAAoBJ,EAAQ,QAAQtB,EAAI0B,QAEjD,CACPvD,GAAI6B,EAAI7B,GACRzC,QACAC,OACA2F,MAAOA,GAAS3E,OAAOqD,EAAI7B,IAAM,IACjCwD,OAAQ3B,EAAI2B,QAAU,KACtBC,SAAkC,iBAAjB5B,EAAI4B,SAAwB5B,EAAI4B,SAAW,EAC5DzF,GAAI6D,EAAI7D,GACRoF,SAAUvB,EAAIuB,SACdM,GAAI7B,EAAI6B,GACR3E,OAAQ8C,EAAI9C,OAEdC,IAAK6C,EAAI7C,IACTC,QAAS4C,EAAI5C,QACbK,YAAauC,EAAIvC,YACjBS,MAAO8B,EAAI9B,MACXD,IAAK+B,EAAI/B,IACTP,IAAKsC,EAAItC,IACTiD,KAAMX,EAAIW,KACVE,SAAUb,EAAIa,SACdC,MAAOd,EAAIc,MACXC,gBAAiBf,EAAIe,gBACnBU,aAAczB,EAAIyB,aAClBK,MAAO9B,EAAI8B,MACXC,KAAM/B,EAAI+B,KACVL,KAAM1B,EAAI0B,KACVF,UAAWxB,EAAIwB,UACfQ,KAAMhC,EAAIgC,KACVC,KAAMjC,EAAIiC,KACVC,WAAYlC,EAAIkC,YAAc,GAC9BjB,KAAMjB,EAAIiB,MAAQ,GAEpBlB,GAAIoC,KAAKC,SAAW,IAAO1D,EAAqB,GAChD2D,GAAIF,KAAKC,SAAW,IAAO1D,EAAsB,GAC/C4D,EAAa,YAAV5G,EAAsBgD,EAAkC,YAAVhD,EAAsBgD,EAAwBA,EAEnG,CAEA,SAAS6D,EAAcC,GACrB,IAAKA,EAAS,OAAO,KAErB,IAAI3E,EAAO2E,EAAQ3E,MAAQ2E,EAAQ5E,KAAO4E,EAAQ7G,MAAQ,cAE1D,MADa,cAATkC,IAAsBA,EAAO,eAC1B,CACL4E,OAAQD,EAAQ1E,SAChB4E,OAAQF,EAAQzE,SAChBF,OACA8E,QAASC,QAAQJ,EAAQG,SACzBE,WAA0C,iBAAvBL,EAAQK,WAA0BL,EAAQK,gBAAa,EAC1EC,MAAON,EAAQ1E,SACfiF,MAAOP,EAAQzE,SAEnB,CA0EA,SAASiF,GAAgBC,SAAEA,EAAAC,IAAUA,EAAAC,QAAKA,OAASC,EAAAC,iBAAMA,EAAAC,YAAkBA,IACzE,OAAKL,EASH9I,EAAAA,KAAA6C,WAAA,CACE9C,SAAA,CAAAC,OAAC,OAAIU,MAAO,CAAEI,QAAS,GAAIsI,aAAc,mCACvCrJ,SAAA,OAAC,MAAA,CAAIW,MAAO,CAAEG,SAAU,GAAIL,WAAY,IAAKU,aAAc,GAAI1B,MAAO,QAAUO,SAAA,UAChFC,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEf,QAAS,OAAQ0J,OAAQ,EAAG7J,MAAO,UAAWqB,SAAU,IACpEd,SAAA,CAAAC,OAAC,MAAA,CAAID,SAAA,CAAAd,EAAAA,IAAC,KAAEc,SAAA,QAAO,IAACd,MAAC,QAAKyB,MAAO,CAAE4I,UAAW,aAAgBvJ,WAASiE,eAClE,MAAA,CAAIjE,SAAA,CAAAd,EAAAA,IAAC,KAAEc,SAAA,WAAU,IAAE+I,EAASvH,gBAC5B,MAAA,CAAIxB,SAAA,CAAAd,EAAAA,IAAC,KAAEc,SAAA,UAAS,IAAE+I,EAAStH,eAC3B,MAAA,CAAIzB,SAAA,CAAAd,EAAAA,IAAC,KAAEc,SAAA,WAAU,IAAE+I,EAAS3B,gBAC5B,MAAA,CAAIpH,SAAA,CAAAd,EAAAA,IAAC,KAAEc,SAAA,YAAW,IAAE+I,EAAStB,iBAC7B,MAAA,CAAIzH,SAAA,CAAAd,EAAAA,IAAC,KAAEc,SAAA,cAAa,IAAE+I,EAASrB,YAC/B/F,MAAMC,QAAQmH,EAAShC,OAASgC,EAAShC,KAAKlG,OAAS,GAAMZ,EAAAA,KAAC,MAAA,CAAID,SAAA,CAAAd,EAAAA,IAAC,KAAEc,SAAA,UAAS,IAAE+I,EAAShC,KAAKjD,KAAK,qBAGvG0F,EAAA,CAAUC,WAAYV,EAAS9E,GAAIgF,UAAkBD,MAAUE,SAChEjJ,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEI,QAAS,GAAI2I,UAAW,kCAAmC9J,QAAS,OAAQQ,IAAK,GAC7FJ,SAAA,CAAAd,MAAC,UAAOyK,QAASR,EAAkBxI,MAAO,CAAEI,QAAS,UAAWK,WAAY,UAAW3B,MAAO,OAAQC,OAAQ,OAAQC,aAAc,GAAKK,SAAA,gBACxI,SAAA,CAAO2J,QAASP,EAAazI,MAAO,CAAEI,QAAS,UAAWK,WAAY,UAAW3B,MAAO,OAAQC,OAAQ,OAAQC,aAAc,GAAKK,SAAA,gBAvBtIC,OAAC,MAAA,CAAIU,MAAO,CAAEI,QAAS,GAAItB,MAAO,UAAWqB,SAAU,IACrDd,SAAA,CAAAd,EAAAA,IAAC,MAAA,CAAIyB,MAAO,CAAEF,WAAY,IAAKU,aAAc,GAAKnB,SAAA,iBAAkB,uCA0B5E,CAEA,SAASwJ,GAAUC,WAAEA,EAAAR,QAAYA,EAAAC,KAASA,EAAAF,IAAMA,IAC9C,OACE/I,OAAC,MAAA,CAAIU,MAAO,CAAEI,QAAS,GAAIV,KAAM,EAAGuJ,SAAU,QAC5C5J,SAAA,OAAC,MAAA,CAAIW,MAAO,CAAEG,SAAU,GAAIL,WAAY,IAAKU,aAAc,EAAG1B,MAAO,QAAUO,SAAA,oBAC9E6J,EAAA,CAASC,SAAS,OAAOL,aAAwBR,UAAkBC,OAAYF,cAC/E,MAAA,CAAIrI,MAAO,CAAEZ,OAAQ,YACrB,MAAA,CAAIY,MAAO,CAAEG,SAAU,GAAIL,WAAY,IAAKU,aAAc,EAAG1B,MAAO,QAAUO,SAAA,oBAC9E6J,EAAA,CAASC,SAAS,QAAQL,aAAwBR,UAAkBC,OAAYF,UAGvF,CAEA,SAASa,GAASC,SAAEA,EAAAL,WAAUA,UAAYR,EAAAC,KAASA,EAAAF,IAAMA,IACvD,MAAMe,EAAQ,GAcd,OAbIN,GAAcP,EAAKO,KACpBT,EAAIgB,IAAIP,IAAe,IAAI7D,QAAQqE,IAClC,MAAMC,EAAIjB,EAAQkB,MAAMC,KAAKC,IAC3B,MAAMpE,EAAIoE,EAAIzB,QAAgC,iBAAfyB,EAAI9B,OAAsB8B,EAAI9B,OAAOtE,GAAKoG,EAAI9B,QACvE+B,EAAID,EAAIxB,QAAgC,iBAAfwB,EAAI7B,OAAsB6B,EAAI7B,OAAOvE,GAAKoG,EAAI7B,QAC7E,OAAQvC,IAAMwD,GAAca,IAAML,GAASK,IAAMb,GAAcxD,IAAMgE,IAEjEM,EAAQrB,EAAKe,GACnB,IAAKC,IAAMK,EAAO,OAClB,MAAMC,EAAQD,EAAM/I,QAAU0H,EAAKO,GAAYjI,OAC7B,SAAbsI,IAAwBU,GAAwB,UAAbV,GAAwBU,IAAQT,EAAMU,KAAK,CAAEP,IAAGK,YAGvFR,EAAMlJ,OAET3B,MAAC,OACEc,SAAA+J,EAAM/I,IAAI,CAAC0J,EAAIxI,IACdjC,EAAAA,KAAC,MAAA,CAAYU,MAAO,CAAEf,QAAS,OAAQ+K,WAAY,SAAUC,eAAgB,gBAAiB7J,QAAS,QAASsI,aAAc,+BAAgCvI,SAAU,IACtKd,SAAA,CAAAC,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEf,QAAS,OAAQ+K,WAAY,SAAUvK,IAAK,GACxDJ,SAAA,OAAC,OAAA,CAAKW,MAAO,CAAEpB,MAAO,EAAGQ,OAAQ,EAAGJ,aAAc,EAAGyB,WAAYgD,EAAasG,EAAGH,MAAM/I,UACvFtC,EAAAA,IAAC,QAAKyB,MAAO,CAAElB,MAAO,WAAcO,SAAA0K,EAAGH,MAAMnD,eAC5C,OAAA,CAAKzG,MAAO,CAAElB,MAAO,WAAaO,SAAA,CAAA,IAAE0K,EAAGH,MAAM9I,KAAK,UAErDxB,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEf,QAAS,OAAQ+K,WAAY,SAAUvK,IAAK,GACvDJ,SAAA,CAAA0K,EAAGR,EAAEzB,SAAWvJ,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAES,WAAY,UAAW3B,MAAO,UAAWsB,QAAS,UAAWpB,aAAc,EAAGmB,SAAU,IAAMd,SAAA,YAC9Hd,EAAAA,IAAC,QAAKyB,MAAO,CAAElB,MAAO,WAAcO,SAAA0K,EAAGR,EAAEvG,YARnCzB,MAJUhD,EAAAA,IAAC,MAAA,CAAIyB,MAAO,CAAEG,SAAU,GAAIrB,MAAO,WAAaO,SAAA,MAkB5E,CAGA,SAAwB6K,GAAkBC,aAAEA,EAAe,OAAOC,kBAAGA,EAAoB,SACvF,MAAMC,EAAQC,EAAAA,SACRC,EAAeD,EAAAA,OAAO,MACtBE,EAAoBF,EAAAA,OAAO,OAC1BG,EAAeC,GAAoBC,EAAAA,SAAS,CAAE/L,MAAO,EAAGQ,OAAQ,KAEhEwL,EAAWC,GAAgBF,EAAAA,SAAS,CAAEG,MAAO,GAAItB,MAAO,MACxDuB,EAAOC,GAAYL,EAAAA,UAAS,IAC5B7B,EAAYmC,GAAiBN,EAAAA,SAAS,OACtCO,EAASC,GAAcR,EAAAA,UAAS,IAChCS,EAAQC,GAAaV,EAAAA,SAAS,KAC9BW,GAAaC,IAAkBZ,EAAAA,SAAS,CAAEjH,UAAU,EAAMC,SAAS,EAAMC,SAAS,KAClF4H,GAAeC,IAAoBd,EAAAA,SAAS,QAC5Ce,GAAcC,IAAmBhB,EAAAA,SAAS,IAAI9F,IAAIrB,KAClDlF,GAAWsN,IAAgBjB,EAAAA,SAAS,KAErCpC,KAAEA,GAAAF,IAAMA,IAAQwD,EAAAA,QAAQ,IA1HhC,SAAwBf,EAAOtB,GAC7B,MAAMjB,EAAOuD,OAAOC,YAAYjB,EAAMzK,IAAI2L,GAAK,CAACA,EAAE1I,GAAI0I,KAChD3D,MAAU4D,IAQhB,OARuBnB,EAAM7F,WAAaoD,EAAI6D,IAAIF,EAAE1I,GAAI,IAAIuB,MAC5D2E,EAAMvE,QAAQsE,IACZ,MAAMjE,EAAwB,iBAAbiE,EAAE3B,OAAsB2B,EAAE3B,OAAOtE,GAAKiG,EAAE3B,OACnD+B,EAAwB,iBAAbJ,EAAE1B,OAAsB0B,EAAE1B,OAAOvE,GAAKiG,EAAE1B,OACrDQ,EAAI8D,IAAI7G,MAAQ+D,IAAI/D,GAAGK,IAAIgE,GAC3BtB,EAAI8D,IAAIxC,MAAQN,IAAIM,GAAGhE,IAAIL,GAC/BiE,EAAEtB,MAAQ3C,EAAGiE,EAAErB,MAAQyB,EAAGJ,EAAE6C,IAAM7D,EAAKjD,GAAIiE,EAAE8C,IAAM9D,EAAKoB,KAEnD,CAAEpB,OAAMF,MACjB,CA+GsCiE,CAAe1B,EAAUE,MAAOF,EAAUpB,OAAQ,CAACoB,IA8BvF2B,EAAAA,UAAU,KACR,MAAMC,EAAKnC,EAAMoC,QAAS,IAAKD,EAAI,OACnC,MAAME,EAAWF,EAAGE,UAAYF,EAAGE,WACnC,GAAIA,EAAU,CAGZA,EAASC,cAAe,EACxBD,EAASE,WAAY,EACrBF,EAASG,YAAa,EAEtB,IAAMH,EAASI,aAAe,CAAEC,KAAMC,EAAYC,OAAQC,OAAQF,EAAYG,MAAOC,MAAOJ,EAAYK,IAAO,OAASC,GAAI,CAC5HZ,EAASa,cAAgB,KACzBb,EAASc,cAAgB,IAC3B,CACAhB,EAAGiB,eAAe,CAAEvI,EAAG,EAAGsC,EAAG,KAAMC,EAAG,GAAK,CAAEvC,EAAG,EAAGsC,EAAG,EAAGC,EAAG,GAAK,GACjE,MAAMiG,EAAQlB,EAAGkB,QAASA,EAAMC,SAASC,MAAQ,MAAOF,EAAMC,SAASzB,IAAI,EAAG,EAAG,EAAG,OA1C/D,MACrB,MAAMwB,EAAQrD,EAAMoC,SAASiB,UAAW,IAAKA,EAAO,OACpD,MAAMG,EAAWH,EAAMI,gBAAgB,gBAAqBD,GAAUH,EAAMK,OAAOF,GACnF,MAAMG,EAAQ,IAAIC,EAAeD,EAAM5L,KAAO,eAC9C,MAAM8L,EAAY,CAACzG,EAAG3I,EAAO2H,KAC3B,MAAM0H,EAAW,IAAIC,EAAoBvK,EAAoBA,EAAqB,EAAG,GAC/EwK,EAAM,IAAIC,EAAwB,CAAExP,QAAOyP,aAAa,EAAMC,QAAS,IAAMC,YAAY,IACzFC,EAAO,IAAIC,EAAWR,EAAUE,GAAMK,EAAKE,SAAS1C,IAAI,EAAG,EAAGzE,GACpE,MAAMoH,EAAQ,IAAIC,EAAoBX,GAChCY,EAAO,IAAIC,EAAmBH,EAAO,IAAII,EAAwB,CAAEnQ,QAAOyP,aAAa,EAAMC,QAAS,OAC5GO,EAAKH,SAAS1C,IAAI,EAAG,EAAGzE,EAAI,IAChC,MAAMyH,EAASC,SAASC,cAAc,UAAWF,EAAOtQ,MAAQ,IAAKsQ,EAAO9P,OAAS,IAAK,MAAMiQ,EAAMH,EAAOI,WAAW,MACxHD,EAAIE,UAAY,gBAAiBF,EAAIG,SAAS,EAAE,EAAE,IAAI,KAAMH,EAAII,KAAO,kBAAmBJ,EAAIE,UAAY,UAAWF,EAAIK,UAAY,OAAQL,EAAIM,aAAe,SAAUN,EAAIO,SAASnJ,EAAO,GAAI,IAClM,MAAMoJ,EAAM,IAAIC,EAAoBZ,GAAea,EAAS,IAAIC,EAAqB,CAAE3P,IAAKwP,EAAKtB,aAAa,EAAMC,QAAS,GAAKC,YAAY,IACxIwB,EAAS,IAAIC,EAAaH,GAASE,EAAOE,MAAMjE,IAAI,IAAK,GAAI,GAEnE+D,EAAOrB,SAAS1C,KAAI,IAA6BrI,EAAoB,EAAI,GAAI4D,EAAI,IAC7EuG,EAAMrI,IAAI+I,GAAOV,EAAMrI,IAAIoJ,GAAOf,EAAMrI,IAAIsK,IAEhD/B,EAAUrK,EAAwBJ,EAAaC,SAAU,YACzDwK,EAAUrK,EAAwBJ,EAAaE,QAAU,WACzDuK,EAAUrK,EAAwBJ,EAAaG,QAAU,WACvD8J,EAAM/H,IAAIqI,IAqBVoC,GAnBwB,MAAe,MAAM1C,EAAQrD,EAAMoC,SAASiB,UAAiBM,EAAQN,GAAOI,gBAAgB,gBAAqBE,IAAOA,EAAM1F,SAAU,IAmB9I+H,IACjB,IAGH9D,EAAAA,UAAU,KACR,MAAMC,EAAKnC,EAAMoC,QAAS,GAAKD,EAAL,CAC1B,IAAMA,EAAG8D,QAAQ,WAAa9D,EAAG8D,QAAQ,UAAUC,SAAS,EAAI,CAAA,MAAS,CACzE,IAAM/D,EAAG8D,QAAQ,SAAW9D,EAAG8D,QAAQ,QAAQC,SAAS,IAAM,IAAO,CAAA,MAAS,CAF3C,GAGlC,IAGHhE,EAAAA,UAAU,KACR,IAAIiE,GAAU,EAed,MAdA,WACE,IACMA,MAAoB,EAC1B,OAASlD,GAAI,CACb,IACE,MACMmD,EAxOd,SAA6BC,GAC3B,MAAMC,MAAe1E,IACfzC,EAAQ,GAEd,IAAA,MAAWoH,KAAOF,EAAY,CAC5B,MAAMG,EAAOD,EAAI7O,QAAU6O,EAAI5E,GAAK4E,EAAIhJ,OAClCkJ,EAAOF,EAAIjO,QAAUiO,EAAIjH,GAAKiH,EAAI/I,OAClCkJ,EAAOH,EAAI9N,MAAQ8N,EAAII,EAC7B,IAAKH,IAASC,EAAM,SACpB,MAAMG,EAAMJ,EAAKvN,GAAU4N,EAAMJ,EAAKxN,GACtC,IAAK2N,IAAQC,EAAK,SACbP,EAASxE,IAAI8E,MAAe/E,IAAI+E,EAAK3K,EAAcuK,IACnDF,EAASxE,IAAI+E,MAAehF,IAAIgF,EAAK5K,EAAcwK,IACxD,MAAMxD,EAAI5F,EAAcqJ,GACpBzD,GAAG9D,EAAMM,KAAKwD,EACpB,CAGA,MAAMxC,EAAQ,IAAI6F,EAASQ,UACrBC,EAAOtG,EAAMtI,OAAOwJ,GAAgB,WAAXA,EAAElL,MAC3BuQ,EAAOvG,EAAMtI,OAAOwJ,GAAiB,aAAZA,EAAEnL,OAC3ByQ,MAAoBrF,IAY1B,OAXAmF,EAAKnM,QAAQ,CAACK,EAAG/D,KACf,MAAMgQ,EAAShQ,EAAI+F,KAAKkK,IAAI,EAAGJ,EAAKlR,QAAWoH,KAAKmK,GAAK,EAEzDH,EAAcpF,IAAI5G,EAAEjD,QAAUiD,EAAEmB,OAASnB,EAAEhC,GAAI,CAAEoO,GAtJrC,IAsJyCpK,KAAKqK,IAAIJ,GAAiBK,GAtJnE,IAsJuEtK,KAAKuK,IAAIN,OAE9FF,EAAKpM,QAAQ6M,IACX,MAAM1O,EAAM0O,EAAEzP,QAAUyP,EAAErL,MACpBsL,EAAIT,EAAcjI,IAAIjG,GACxB2O,IAAKD,EAAE5M,EAAI6M,EAAEL,GAA6B,IAAvBpK,KAAKC,SAAW,IAAWuK,EAAEtK,EAAIuK,EAAEH,GAA6B,IAAvBtK,KAAKC,SAAW,OAG3E,CAAEuD,QAAOtB,QAClB,CAsMkBwI,OAnMlBC,iBACE,MAAMC,EAAM,GAAG5N,+CAAmE6N,mBArJ7D,iBAsJfC,QAAYC,MAAMH,GACxB,IAAKE,EAAIE,GAAI,MAAM,IAAIC,MAAM,sBAAsBH,EAAItL,UACvD,OAAOsL,EAAII,MACb,CA6L8BC,IAElBjC,KAAsBC,EAC5B,OAASnD,GACHkD,GAAS3F,EAhLrB,WACE,MAAMC,EAAQ,GACRtB,EAAQ,GACd,IAAA,IAASjI,EAAI,EAAGA,EAAI,GAAIA,IAAKuJ,EAAMhB,KAAK,CAAExG,GAAI,OAAO/B,IAAKV,MAAO,WAAYC,KAAM,SAAU2F,MAAO,OAAOlF,IAAKuF,OAAQ,KAAMC,SAAU,EAAG7B,GAAIoC,KAAKC,SAAS,IAAK1D,EAAmB2D,GAAIF,KAAKC,SAAS,IAAK1D,EAAmB4D,EAAG5D,IAClO,IAAA,IAAStC,EAAI,EAAGA,EAAI,GAAIA,IAAKuJ,EAAMhB,KAAK,CAAExG,GAAI,OAAO/B,IAAKV,MAAO,UAAWC,KAAM,UAAW2F,MAAO,OAAOlF,IAAKuF,OAAQ,KAAMC,SAAU,EAAG7B,GAAIoC,KAAKC,SAAS,IAAK1D,EAAmB2D,GAAIF,KAAKC,SAAS,IAAK1D,EAAmB4D,EAAG5D,IAClO,IAAA,IAAStC,EAAI,EAAGA,EAAI,GAAIA,IAAKuJ,EAAMhB,KAAK,CAAExG,GAAI,QAAQ/B,IAAKV,MAAO,UAAWC,KAAM,OAAQ2F,MAAO,QAAQlF,IAAKuF,OAAQ,KAAMC,SAAU,EAAG7B,GAAIoC,KAAKC,SAAS,IAAK1D,EAAmB2D,GAAIF,KAAKC,SAAS,IAAK1D,EAAmB4D,EAAG5D,IACjO,IAAA,IAAStC,EAAI,EAAGA,EAAI,GAAIA,IAAKiI,EAAMM,KAAK,CAAElC,OAAQ,OAAON,KAAKoL,MAAoB,GAAdpL,KAAKC,YAAgBM,OAAQ,OAAOP,KAAKoL,MAAoB,GAAdpL,KAAKC,YAAgBvE,KAAM,UAC9I,IAAA,IAASzB,EAAI,EAAGA,EAAI,GAAIA,IAAKiI,EAAMM,KAAK,CAAElC,OAAQ,QAAQN,KAAKoL,MAAoB,GAAdpL,KAAKC,YAAgBM,OAAQ,OAAOP,KAAKoL,MAAoB,GAAdpL,KAAKC,YAAgBvE,KAAM,SAC/I,MAAO,CAAE8H,QAAOtB,QAClB,CAuKkCmJ,GAC5B,CAAA,QACMnC,MAAoB,EAC1B,CACF,EAbA,GAcO,KAAQA,GAAU,IACxB,IAGHjE,EAAAA,UAAU,KACR,MAAMqG,EAAW,KAAQ,IAAMvI,EAAMoC,SAAWpC,EAAMoC,QAAQoG,UAAU,IAAK,GAAK,CAAA,MAAS,IACvFjI,EAAUE,OAAO5K,QAAU0K,EAAUpB,OAAOtJ,+BAA8B0S,GAC9E,MAAME,EAAKvI,EAAakC,QACxB,IAAIsG,EAOJ,OANID,GAAgC,oBAAnBE,gBACfD,EAAK,IAAIC,eAAe,IAAMC,sBAAsBL,IACpDG,EAAGG,QAAQJ,IAEXK,OAAOC,iBAAiB,SAAUR,GAE7B,KACDG,GAAMD,GAAIC,EAAGM,UAAUP,GAC3BK,OAAOG,oBAAoB,SAAUV,KAEtC,CAAChI,IAEJ2B,EAAAA,UAAU,KACR,MAAMuG,EAAKtI,EAAkBiC,QAC7B,IAAKqG,EAAI,OACT,MAAMS,EAAU,KACd,IAAM7I,EAAiB,CAAE9L,MAAOkU,EAAGU,aAAe,EAAGpU,OAAQ0T,EAAGW,cAAgB,GAAM,CAAA,MAAS,GAGjG,IAAIV,EACJ,GAFAQ,IAE8B,oBAAnBP,eAAgC,CACzCD,EAAK,IAAIC,eAAe,IAAMO,KAC9B,IAAMR,EAAGG,QAAQJ,EAAK,CAAA,MAAS,CACjC,MACEK,OAAOC,iBAAiB,SAAUG,GAEpC,MAAO,KACL,IAAUR,GAAMD,GAAIC,EAAGM,UAAUP,EAAK,CAAA,MAAS,CAC/CK,OAAOG,oBAAoB,SAAUC,KAEtC,IAGHhH,EAAAA,UAAU,KACR,MAAMC,EAAKnC,EAAMoC,QAAS,IAAKD,EAAI,OACnC,MAAMkH,EAAMlH,EAAGmH,WAAWC,WACpBlG,EAAQlB,EAAGkB,QACcmG,EAAYvM,KAAKmK,GAAG,EAASqC,EAAaC,IAA2FC,EAAW1M,KAAKmK,GAAG,GACjLwC,EAAW,KAAQvG,EAAMC,SAASzI,EAAIgP,EAAgBC,MAAMzG,EAAMC,SAASzI,GAD7D,SAC4FwI,EAAMC,SAASnG,EAAI0M,EAAgBC,MAAMzG,EAAMC,SAASnG,GAAIqM,EAAWA,GAAYnG,EAAMC,SAASlG,EAAIyM,EAAgBC,MAAMzG,EAAMC,SAASlG,GAAG,IAAaqM,GAAapG,EAAMC,SAASC,MAAM,OAC/S,IAAIwG,GAAS,EAAMC,EAAM,EAAEC,EAAM,EAC7BC,GAAe,EACjB,MAAMC,EAAQlH,GAAMA,EAAEmH,UAAYnH,EAAEoH,SAAWpH,EAAEoH,QAAQ,IAAID,UAAY,EACnEE,EAAQrH,GAAMA,EAAEsH,UAAYtH,EAAEoH,SAAWpH,EAAEoH,QAAQ,IAAIE,UAAY,EACrEC,EAAUvH,IAAM,IAAI8G,EAAU,OAAQ,MAAMlP,EAAEsP,EAAKlH,GAAI9F,EAAEmN,EAAKrH,GAAUwH,EAAG5P,EAAEmP,EAAOU,EAAGvN,EAAE8M,EAAOD,EAAMnP,EAAGoP,EAAM9M,EAAM+M,EAAe7G,EAAMC,SAASlG,GANA,KAMKqN,GAAuBpH,EAAMC,SAASnG,GANpE,KAMyEsN,EAAapH,EAAMC,SAASzI,GAN7H,KAMkI6P,GAAiBd,KACnPe,EAAO,KAAKZ,GAAS,GAErBa,EAAU3H,IACd,IACE,IAAuB,UAAlBA,EAAE4H,aAA+C,iBAAb5H,EAAE6H,SAAqC,IAAb7H,EAAE6H,OAAc,CACjF,IAAM7H,EAAE8H,iBAAkB9H,EAAE+H,iBAAmB,OAASC,GAAM,CAC9D,MACF,CACF,OAASA,GAAM,CACflB,GAAS,EAAMC,EAAMG,EAAKlH,GAAIgH,EAAMK,EAAKrH,IAE3CoG,EAAIN,iBAAiB,cAAe6B,EAAQ,CAAEM,SAAS,IACzD,MAAMC,EAAiBC,IAAS,IAAMA,EAAGL,gBAAkB,OAAS9H,GAAI,GACxEoG,EAAIN,iBAAiB,cAAeoC,GAClCrC,OAAOC,iBAAiB,cAAeyB,GACvC1B,OAAOC,iBAAiB,YAAa4B,GACrCtB,EAAIN,iBAAiB,eAAgB4B,GACrC,MAAMU,EAAY,IAAIC,EAAc,EAAE,EAAE,GAAGC,YACrCC,EAASvI,IAAM,IAAIwI,GAAK,EAAM,OAAOxI,EAAElK,KAAM,IAAK,UAAWsK,EAAMC,SAASzI,GAAK8O,EAAU,MAAO,IAAK,YAAatG,EAAMC,SAASzI,GAAK8O,EAAU,MAAO,IAAK,YAAatG,EAAMC,SAASnG,GAAKwM,EAAU,MAAO,IAAK,aAActG,EAAMC,SAASnG,GAAKwM,EAAU,MAAO,IAAK,IAAK,IAAK,IAAKtG,EAAMC,SAASlG,GAAKuM,EAAU,MAAO,IAAK,IAAK,IAAK,IAAKtG,EAAMC,SAASlG,GAAKuM,EAAU,MAAO,IAAK,IAAK,IAAK,IAAKtG,EAAMC,SAASzB,IAAI,EAAE,EAAE,EAAE,OAAQ,MAAO,IAAK,IAAK,IAAK,IAAKwB,EAAMqI,kBAAkBL,GAAY1B,GAAWtG,EAAMC,SAASqI,kBAAkBtI,EAAMuI,WAAW,OAAQ,MAAO,IAAK,IAAK,IAAK,IAAKvI,EAAMqI,kBAAkBL,GAAY1B,GAAWtG,EAAMC,SAASqI,kBAAkBtI,EAAMuI,WAAW,OAAQ,MAAO,QAASH,GAAK,EAAWA,GAAM7B,KAE7tBiC,EAAeT,IAAS,GAAgB,UAAZA,EAAGU,MAA+B,MAAXV,EAAGrS,IAAa,CAAEmR,GAAe,EAAM,IAAMkB,EAAGL,gBAAkB,CAAA,MAAS,CAAE,GAChIgB,EAAaX,IAAS,GAAgB,UAAZA,EAAGU,MAA+B,MAAXV,EAAGrS,IAAa,CAAEmR,GAAe,EAAO,IAAMkB,EAAGL,gBAAkB,CAAA,MAAS,CAAE,GAKrI,OAHAjC,OAAOC,iBAAiB,UAAWyC,GACnC1C,OAAOC,iBAAiB,UAAW8C,GACnC/C,OAAOC,iBAAiB,QAASgD,GAC1B,KAAM1C,EAAIJ,oBAAoB,cAAe2B,GAASvB,EAAIJ,oBAAoB,cAAekC,GAAgBrC,OAAOG,oBAAoB,cAAeuB,GAAS1B,OAAOG,oBAAoB,YAAa0B,GAAOtB,EAAIJ,oBAAoB,eAAgB0B,GAAO7B,OAAOG,oBAAoB,UAAWuC,GAAQ1C,OAAOG,oBAAoB,UAAW4C,GAAc/C,OAAOG,oBAAoB,QAAS8C,KAC1Y,IAGH,MAAM9N,GAAUuD,EAAAA,QAAQ,KACtB,MAUMwK,EAAU,IAAIxR,IAAI+F,EAAUE,MAAMtI,OAVpBwJ,IAClB,IAAKV,GAAYU,EAAEnL,OAAQ,OAAO,EAClC,GAAIuK,EAAQ,CACV,MAAMkL,EAAIlL,EAAOnJ,cAGjB,IAFY,CAAC+J,EAAEvF,MAAMuF,EAAE1K,GAAG0K,EAAErF,UAAUqF,EAAE7E,KAAK6E,EAAE5E,KAAK4E,EAAEtF,SAASsF,EAAEpF,aAAaoF,EAAE3J,OAAO2J,EAAElL,MACtF0B,OAAOuF,SAAS5E,KAAK,KAAKlB,cACpB4D,SAASyQ,GAAI,OAAO,CAC/B,CACA,OAAO,IAEkDjW,IAAI2L,GAAKA,EAAE1I,KAUhEkG,EAAQoB,EAAUpB,MAAMhH,OATV+G,IAClB,MAAMjE,EAAIiE,EAAEtB,QAA4B,iBAAXsB,EAAE3B,OAAkB2B,EAAE3B,OAAOtE,GAAGiG,EAAE3B,QACzD+B,EAAIJ,EAAErB,QAA4B,iBAAXqB,EAAE1B,OAAkB0B,EAAE1B,OAAOvE,GAAGiG,EAAE1B,QAC/D,IAAKwO,EAAQlK,IAAI7G,KAAO+Q,EAAQlK,IAAIxC,GAAI,OAAO,EAC/C,GAAsB,QAAlB6B,MAA8BjC,EAAEzB,UAA6B,SAAhB0D,IAA0B,OAAO,EAClF,MAAM+K,EAAKhO,GAAKjD,GAAUkR,EAAKjO,GAAKoB,GACpC,QAAI4M,GAAMC,KAAW9K,GAAaS,IAAIoK,EAAGzP,UAAY4E,GAAaS,IAAIqK,EAAG1P,YAIrEgP,MAAWjR,IAEjB,OAFwB2E,EAAMvE,QAAQsE,IAAO,MAAMjE,EAAIiE,EAAEtB,QAA4B,iBAAXsB,EAAE3B,OAAkB2B,EAAE3B,OAAOtE,GAAGiG,EAAE3B,QAAe+B,EAAIJ,EAAErB,QAA4B,iBAAXqB,EAAE1B,OAAkB0B,EAAE1B,OAAOvE,GAAGiG,EAAE1B,QAASiO,EAAKnQ,IAAIL,GAAIwQ,EAAKnQ,IAAIgE,KAE5M,CAAEmB,MADKF,EAAUE,MAAMtI,OAAOwJ,GAAKqK,EAAQlK,IAAIH,EAAE1I,MAAQwS,EAAK3J,IAAIH,EAAE1I,MAAQ8H,IACnE5B,UACf,CAACoB,EAAWU,GAAaE,GAAeE,GAAcN,EAAQ7C,KAE3DkO,GAAY5K,EAAAA,QAAQ,KACxB,IAAK/C,EAAY,MAAO,CAAEgC,MAAO,IAAIjG,IAAO2E,MAAO,IAAI3E,KACvD,MAAM6R,EAAO,IAAI7R,IAAI,CAACiE,IAAoB6N,MAAW9R,IAGrD,OAFCwD,GAAIgB,IAAIP,IAAe,IAAI7D,QAAQqE,GAAOoN,EAAK/Q,IAAI2D,IACpDhB,GAAQkB,MAAMvE,QAAQsE,IAAO,MAAMjE,EAAIiE,EAAEtB,QAA4B,iBAAXsB,EAAE3B,OAAkB2B,EAAE3B,OAAOtE,GAAGiG,EAAE3B,QAAe+B,EAAIJ,EAAErB,QAA4B,iBAAXqB,EAAE1B,OAAkB0B,EAAE1B,OAAOvE,GAAGiG,EAAE1B,QAAa6O,EAAKvK,IAAI7G,IAAMoR,EAAKvK,IAAIxC,IAAIgN,EAAKhR,IAAI4D,KAC/M,CAAEuB,MAAO4L,EAAMlN,MAAOmN,IAC5B,CAAC7N,EAAYR,GAASD,KAGnBuO,GAAgBrN,GAAMT,IAAe2N,GAAUjN,MAAM2C,IAAI5C,GAEzDsN,GAAatN,IAAQ,MAAMuN,EAAM,IAAIC,EAAYjT,EAAYyF,EAAEvG,OAAS,WAAyF,MAAO,KAA1E4T,GAAarN,GAAKuN,EAAIE,KAAK,IAAID,EAAY,WAAY,IAAOD,GAAkBG,kBAK9KC,GAAoB,KAAQjM,EAAc,MAAOd,EAAa,MAAOC,EAAkB,MAAOwB,GAAa,KAC3GuL,GAAY,KAAQlM,EAAc,MAAOd,EAAa,MAAO,MAAMqC,EAAKnC,EAAMoC,QAAS,GAAKD,EAAL,CAAiB,IAAM,MAAM4K,EAAM5K,EAAGkB,QAAQC,SAAUyJ,EAAIxJ,MAAM,MAAOwJ,EAAIlS,EAAI,EAAGkS,EAAI5P,EAAI,EAAG4P,EAAI3P,EAAI,CAAG,CAAA,MAAS,CAAE+E,EAAGiB,eAAe,CAAEvI,EAAG,EAAGsC,EAAG,KAAMC,EAAG,GAAK,CAAEvC,EAAG,EAAGsC,EAAG,EAAGC,EAAG,GAAK,IAA7K,GAChG4P,GAAe1S,IAEnB,GADAsG,EAActG,GAAMrB,IAAM,MACtBqB,EAAM,CACR,MAAM2S,EAAQ/Y,EAAAA,IAAC4J,EAAA,CAAgBC,SAAUzD,EAAM0D,OAAUC,WAAkBC,QAAYC,iBAAkB0O,GAAmBzO,YAAa0O,KACzIhN,EAAamN,GACb,IAAMlN,EAAkBkN,EAAQ,OAAQhK,GAAI,CAG5C,MAAMiK,EAAiBlP,GAAIgB,IAAI1E,EAAKrB,SAAWuB,IACzC3D,EAAeF,MAAMqF,KAAKkR,GAC7BlX,IAAIiJ,GAAOf,GAAKe,IAChB9G,OAAOwJ,GAAKA,GAAKA,EAAE1K,IACnBjB,IAAI2L,GAAKA,EAAE1K,IAGRE,EAAS8G,GAAQkB,MACpBhH,OAAOgV,IACN,MAAMvG,EAAMuG,EAAKvP,QAAiC,iBAAhBuP,EAAK5P,OAAsB4P,EAAK5P,OAAOtE,GAAKkU,EAAK5P,QAC7EsJ,EAAMsG,EAAKtP,QAAiC,iBAAhBsP,EAAK3P,OAAsB2P,EAAK3P,OAAOvE,GAAKkU,EAAK3P,QACnF,OAAOoJ,IAAQtM,EAAKrB,IAAM4N,IAAQvM,EAAKrB,KAExCjD,IAAImX,IACH,MAAMvG,EAAMuG,EAAKvP,QAAiC,iBAAhBuP,EAAK5P,OAAsB4P,EAAK5P,OAAOtE,GAAKkU,EAAK5P,QAC7EsJ,EAAMsG,EAAKtP,QAAiC,iBAAhBsP,EAAK3P,OAAsB2P,EAAK3P,OAAOvE,GAAKkU,EAAK3P,QAC7E4P,EAAUlP,GAAK0I,GACfyG,EAAUnP,GAAK2I,GAErB,MAAO,CACLnP,OAAQ0V,EAAU,CAChBnU,GAAImU,EAAQnU,GACZhC,GAAImW,EAAQnW,GACZc,KAAMqV,EAAQhR,OAASgR,EAAQ/Q,UAAY+Q,EAAQrV,MAAQqV,EAAQ9Q,WAAa8Q,EAAQ7Q,cAAgB6Q,EAAQnU,GAChHxC,KAAM2W,EAAQ3W,KACduB,OAAQoV,EAAQpV,OAChBC,IAAKmV,EAAQnV,IACbC,QAASkV,EAAQlV,QACjBK,YAAa6U,EAAQ7U,aAAe6U,EAAQ7Q,aAC5C/D,IAAK6B,EAAW+S,GAChBpU,MAAOoU,EAAQpU,MACfD,IAAKqU,EAAQrU,IACbpB,SAAU,CAACyV,EAAQ5W,MAAO4W,EAAQ3W,MAClC6W,KAAMF,EAAQnU,GACdsU,MAAOH,EAAQG,OACb,KACJjV,OAAQ+U,EAAU,CAChBpU,GAAIoU,EAAQpU,GACZhC,GAAIoW,EAAQpW,GACZc,KAAMsV,EAAQjR,OAASiR,EAAQhR,UAAYgR,EAAQtV,MAAQsV,EAAQ/Q,WAAa+Q,EAAQ9Q,cAAgB8Q,EAAQpU,GAChHV,YAAa8U,EAAQ9U,aAAe8U,EAAQ9Q,aAC5C/D,IAAK6B,EAAWgT,GAChBrU,MAAOqU,EAAQrU,MACfD,IAAKsU,EAAQtU,IACbpB,SAAU,CAAC0V,EAAQ7W,MAAO6W,EAAQ5W,MAClC6W,KAAMD,EAAQpU,GACdsU,MAAOF,EAAQE,OACb,KACJ9U,KAAM,CACJG,SAAUgO,EACV/N,SAAUgO,EACVlO,KAAMwU,EAAKxU,KACXD,IAAKyU,EAAKxU,KACV8E,QAAS0P,EAAK1P,QACdE,WAAYwP,EAAKxP,eAKnB6P,EAAS,CACbnX,QAAS,UAAUiE,EAAK8B,OAAS9B,EAAKrB,KACtC3C,SAAU,CAAEE,MAAO8D,EAAK9D,MAAOC,KAAM6D,EAAK7D,KAAMQ,GAAIqD,EAAKrD,IACzDP,eAAgBwW,EAAeO,KAC/B5W,eACAM,UAEFoK,GAAa,CAACiM,GAChB,MAAS1N,EAAa,MAAOC,EAAkB,MAAOwB,GAAa,KAM/DmM,GAAgBlM,EAAAA,QAAQ,KAC5B,GAAId,EAAO,OAAOzC,GAClB,IAAKQ,EAAY,MAAO,CAAEgC,MAAOxC,GAAQwC,MAAOtB,MAAO,IACvD,MAAMwO,EAAM,IAAInT,IAAI,CAACiE,KAAeT,GAAIgB,IAAIP,IAAe,IAAI7D,QAAQqE,GAAO0O,EAAIrS,IAAI2D,IACtF,MAAME,EAAQlB,GAAQkB,MAAMhH,OAAO+G,IAAO,MAAMjE,EAAIiE,EAAEtB,QAA4B,iBAAXsB,EAAE3B,OAAmB2B,EAAE3B,OAAOtE,GAAKiG,EAAE3B,QAAe+B,EAAIJ,EAAErB,QAA4B,iBAAXqB,EAAE1B,OAAmB0B,EAAE1B,OAAOvE,GAAKiG,EAAE1B,QAAS,OAAOmQ,EAAI7L,IAAI7G,IAAM0S,EAAI7L,IAAIxC,KAC7N,MAAO,CAAEmB,MAAOxC,GAAQwC,MAAOtB,UAC9B,CAACuB,EAAOzC,GAASQ,EAAYT,KAEhC,OACE9J,EAAAA,IAACC,EAAA,CAAKyZ,IAAK1N,EAAc7L,GAAI,CAC3BE,MAAO,OACPQ,OAAQ,sBACRP,QAAS,mBACTG,aAAc,EACdkZ,UAAW,EACXjP,SAAU,UAEV5J,SAAAC,EAAAA,KAACC,EAAA,CAAYb,GAAI,CAAEc,EAAG,EAAGJ,OAAQ,OAAQH,QAAS,OAAQQ,IAAK,GAE7DJ,SAAA,CAAAd,EAAAA,IAAC,MAAA,CAAIyB,MAAO,CAAEN,KAAM,EAAGf,SAAU,EAAGS,OAAQ,QAC1CC,SAAAd,EAAAA,IAAC,MAAA,CAAIyB,MAAO,CAAEpB,MAAO,OAAQQ,OAAQ,OAAQO,UAAW,IAAKb,MAAO,OAAQG,QAAS,OAAQC,cAAe,OAC1GG,SAAAd,EAAAA,IAACC,GAAKE,GAAI,CACRgB,KAAM,EACNkP,SAAU,WACV3F,SAAU,SACVjK,aAAc,OACdkZ,UAAW,oCACXzX,WAAY,UACZ0X,GAAI,GAEJ9Y,SAAAC,EAAAA,KAAC,MAAA,CAAI2Y,IAAKzN,EAAmBxK,MAAO,CAClCpB,MAAO,OACPQ,OAAQ,OACRwP,SAAU,YAGVvP,SAAA,CAAAd,EAAAA,IAAC6Z,EAAA,CACCN,KAAK,QACL,aAAW,mBACXO,MAAM,mBACNrP,QAAS,IAAMmK,OAAOmF,SAASC,KAAO,kCACtC7Z,GAAI,CACFkQ,SAAU,WACV4J,IAAK,GACLC,MAAO,GACPC,OAAQ,IACR7Z,QAAS,uBACTC,MAAO,OACPE,aAAc,MACdJ,MAAO,GACPQ,OAAQ,GACR8Y,UAAW,iCACX,UAAW,CACTrZ,QAAS,UACTC,MAAO,SAIXO,eAACsZ,EAAA,CAAgB3Y,MAAO,CAAEG,SAAU,cAGzC,MAAA,CAAIH,MAAO,CAAE4O,SAAU,WAAY4J,IAAK,GAAII,KAAM,GAAIF,OAAQ,GAAIjY,WAAY,sBAAuBoY,eAAgB,YAAa9Z,OAAQ,kCAAmCC,aAAc,GAAIoB,QAAS,IAC3Mf,gBAAC,MAAA,CAAIW,MAAO,CAAEf,QAAS,OAAQ6Z,SAAU,OAAQrZ,IAAK,GAAIuK,WAAY,SAAU7J,SAAU,IACxFd,SAAA,CAAAd,EAAAA,IAAC,QAAA,CAAMwa,YAAY,qCAAqC1V,MAAO+H,EAAQ4N,SAAW1L,GAAIjC,EAAUiC,EAAEzF,OAAOxE,OAAQrD,MAAO,CAAEI,QAAS,UAAWpB,aAAc,EAAGD,OAAQ,kCAAmC0B,WAAY,qBAAsB3B,MAAO,UACnPP,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAEpB,MAAO,EAAGQ,OAAQ,GAAIqB,WAAY,2BAChD,CAAC,WAAW,UAAU,WAAWJ,IAAIiD,GACpChE,EAAAA,KAAC,QAAA,CAAeU,MAAO,CAAEf,QAAS,OAAQQ,IAAK,EAAGuK,WAAY,UAC5D3K,SAAA,CAAAd,MAAC,QAAA,CAAMuC,KAAK,WAAWmY,QAAS3N,GAAYhI,GAAK0V,SAAW1L,GAAI/B,WAAuB9I,EAAEa,CAACA,GAAIgK,EAAEzF,OAAOoR,aACrG3Z,EAAAA,KAAC,OAAA,CAAKU,MAAO,CAAEf,QAAS,cAAeQ,IAAK,EAAGuK,WAAY,UACzD3K,SAAA,OAAC,OAAA,CAAKW,MAAO,CAAEpB,MAAO,GAAIQ,OAAQ,GAAIJ,aAAc,EAAGyB,WAAYgD,EAAaH,MAChF/E,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAElB,MAAO2E,EAAaH,GAAKxD,WAAY,KAAQT,SAAAiE,SAJtDA,IAQd/E,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAEpB,MAAO,EAAGQ,OAAQ,GAAIqB,WAAY,2BAC/CnB,EAAAA,KAAC,QAAA,CAAMU,MAAO,CAAEf,QAAS,OAAQ+K,WAAY,SAAUvK,IAAK,GAC1DJ,SAAA,CAAAd,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAElB,MAAO,UAAWgB,WAAY,KAAOT,SAAA,YACpDC,EAAAA,KAAC,SAAA,CAAO+D,MAAOmI,GAAewN,SAAW1L,GAAI7B,GAAiB6B,EAAEzF,OAAOxE,OAAQrD,MAAO,CAAES,WAAY,qBAAsB3B,MAAM,UAAWC,OAAO,kCAAmCC,aAAc,EAAGoB,QAAS,UAAWN,WAAY,KACpOT,SAAA,CAAAd,EAAAA,IAAC,SAAA,CAAO8E,MAAM,MAAMrD,MAAO,CAAElB,MAAO,WAAaO,SAAA,QACjDd,EAAAA,IAAC,UAAO8E,MAAM,OAAOrD,MAAO,CAAElB,MAAO,WAAaO,SAAA,SAClDd,EAAAA,IAAC,UAAO8E,MAAM,QAAQrD,MAAO,CAAElB,MAAO,WAAaO,SAAA,gBAGzDd,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAEpB,MAAO,EAAGQ,OAAQ,GAAIqB,WAAY,2BAC/CnB,EAAAA,KAAC,MAAA,CAAIU,MAAO,CAAEf,QAAS,OAAQ+K,WAAY,SAAUvK,IAAK,GACxDJ,SAAA,CAAAd,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAElB,MAAO,UAAWgB,WAAY,KAAOT,SAAA,WACnDmE,EAAOnD,IAAIiF,IACV,IAAIxG,EAAQ,UAIZ,MAHU,OAANwG,EAAYxG,EAAQ,UACT,SAANwG,EAAcxG,EAAQ,UAChB,YAANwG,IAAiBxG,EAAQ,WAEhCQ,OAAC,QAAA,CAAcU,MAAO,CAAEf,QAAQ,OAAQ+K,WAAW,SAAUvK,IAAI,GAC/DJ,SAAA,CAAAd,EAAAA,IAAC,QAAA,CAAMuC,KAAK,WAAWmY,QAASvN,GAAaS,IAAI7G,GAAI0T,SAAW1L,IAAK,MAAM4L,EAAI,IAAIrU,IAAI6G,IAAe4B,EAAEzF,OAAOoR,QAAQC,EAAIvT,IAAIL,GAAG4T,EAAIC,OAAO7T,GAAIqG,GAAgBuN,MACjK3a,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAEoZ,cAAe,YAAata,QAAOgB,WAAY,KAAQT,SAAAiG,MAF5DA,QAOpB/G,EAAAA,IAAC,OAAA,CAAKyB,MAAO,CAAEpB,MAAO,EAAGQ,OAAQ,GAAIqB,WAAY,2BACjDlC,EAAAA,IAAC,SAAA,CAAOyK,QAAS,IAAIgC,EAASxL,IAAIA,GAAIQ,MAAO,CAAEI,QAAQ,UAAWpB,aAAa,EAAGyB,WAAYsK,EAAQ,UAAY,UAAWjM,MAAM,OAAQC,OAAO,mCAAsCM,SAAA0L,EAAQ,QAAU,WAC1MxM,MAAC,SAAA,CAAOyK,QAAS,KAAQqC,EAAU,IAAKE,GAAe,CAAE7H,UAAU,EAAMC,SAAS,EAAMC,SAAS,IAAS6H,GAAiB,OAAQE,GAAgB,IAAI9G,IAAIrB,KAAaxD,MAAO,CAAEI,QAAQ,UAAWpB,aAAa,EAAGyB,WAAW,UAAW3B,MAAM,OAAQC,OAAO,mCAAqCM,SAAA,iBACnS,SAAA,CAAO2J,QAASmO,GAAWnX,MAAO,CAAEI,QAAQ,UAAWpB,aAAa,EAAGyB,WAAW,UAAW3B,MAAM,OAAQC,OAAO,mCAAqCM,SAAA,eAI5Jd,EAAAA,IAAC8a,EAAA,CACCpB,IAAK5N,EACLO,UAAWmN,GACXuB,gBAAgB,UAChB1a,MAAO6L,EAAc7L,MACrBQ,OAAQqL,EAAcrL,OACtBma,gBAAiB,KACjBC,UA1MWxN,GAAQlD,GAFN,CAACkD,GAAMlD,IAAe2N,GAAU3L,MAAMqB,IAAIH,EAAE1I,IAEemW,CAAazN,GAAK,UAAzDvI,EAAauI,EAAEnL,QAAU,UA2M1D6Y,UAAY1N,GAAM,GAAGA,EAAEvF,iBAAiBuF,EAAEnL,SAC1C8Y,YAAa,IACb9C,aACA+C,UA5MWrQ,GAAMqN,GAAarN,GAAK,GAAOA,EAAEzB,QAAU,GAAM,IA6M5D+R,aA3MctQ,IAAQ,MAAMzK,EAAQ,IAAIiY,EAAYF,GAAUtN,IAAK,GAAIA,EAAEzB,QAAW,IAAM,OAAO,IAAIgS,EAAyB,CAAEhb,QAAOib,SAAU,EAAGC,QAAS,EAAGzL,aAAa,EAAMC,QAASoI,GAAarN,GAAK,IAAO,KAAS,CAAA,MAAU,OAAO,IAAI0F,EAAwB,CAAEnQ,QAAOyP,aAAa,EAAMC,QAASoI,GAAarN,GAAK,IAAO,KAAS,CAAI,OAAO,IAAI0F,EAAwB,CAAEnQ,QAAOyP,aAAa,EAAMC,QAASoI,GAAarN,GAAK,IAAO,OA4Mvb0Q,yBA7Me1Q,IAAQ,IAAKwB,IAAUjC,EAAY,OAAO,EAAG,MAAMxD,EAAIiE,EAAE3B,OAAc+B,EAAIJ,EAAE1B,OAAQ,OAAKvC,GAAMqE,QAAqB,IAATrE,EAAEhC,SAAsC,IAATqG,EAAErG,GAAiDgC,EAAEhC,KAAOwF,GAAca,EAAErG,KAAOwF,IAvd9NoR,EAud+QvQ,EAAHrE,EAvdpQzE,QAAUqZ,EAAErZ,OAudoQ,EAAJ,EAA5G,EAvd5K,IAAIqZ,GAqqBfC,6BAA8B,IAAM,EACpCC,6BAA8B,IAAM,KAAsB,KAAd9S,KAAKC,SACjD8P,eACAH,qBACAmD,YAhIa9Q,IAAQ,MAAM0H,EAAM1H,EAAEtB,QAA4B,iBAAXsB,EAAE3B,OAAkB2B,EAAE3B,OAAOtE,GAAGiG,EAAE3B,QAAejD,EAAO4D,GAAK0I,GAAUtM,MAAkBA,IAiI7I2V,aAhIa,CAAC9C,EAAM+C,KAAe,IAAM,MAAMxL,EAAOyI,EAAKgD,WAAaD,EAAcxL,GAAQA,EAAK0L,sBAAsB1L,EAAK0L,sBAAwB,CAAA,MAAS,GAiI/JC,cAAe,EACfC,gBAAgB,EAChBC,aAAa,IAEd1P,SACE,MAAA,CAAIlL,MAAO,CAAC4O,SAAS,WAAWgK,KAAK,EAAEJ,IAAI,EAAEC,MAAM,EAAEoC,OAAO,EAAE5b,QAAQ,OAAO+K,WAAW,SAASC,eAAe,SAAS6Q,cAAc,QACtIzb,eAAC,OAAIW,MAAO,CAACS,WAAW,kBAAkB3B,MAAM,OAAOsB,QAAQ,YAAYpB,aAAa,EAAE6Z,eAAe,aAAcxZ,iCAS3Hd,MAACwc,GAAczc,mBAIvB"}